<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Programando con R | Programación</title>
  <meta name="description" content="3 Programando con R | Programación" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Programando con R | Programación" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Programando con R | Programación" />
  
  
  

<meta name="author" content="Yali-Samaniego Roy &amp; Prudencio-Paredes Fernando" />


<meta name="date" content="2021-08-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introducción-a-r.html"/>
<link rel="next" href="rmarkdown.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Programación</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introducción al curso</a></li>
<li class="chapter" data-level="2" data-path="introducción-a-r.html"><a href="introducción-a-r.html"><i class="fa fa-check"></i><b>2</b> Introducción a R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introducción-a-r.html"><a href="introducción-a-r.html#instalación-de-r-rstudio-y-rtools"><i class="fa fa-check"></i><b>2.1</b> Instalación de R, RStudio y RTools</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introducción-a-r.html"><a href="introducción-a-r.html#r"><i class="fa fa-check"></i><b>2.1.1</b> R</a></li>
<li class="chapter" data-level="2.1.2" data-path="introducción-a-r.html"><a href="introducción-a-r.html#rstudio"><i class="fa fa-check"></i><b>2.1.2</b> Rstudio</a></li>
<li class="chapter" data-level="2.1.3" data-path="introducción-a-r.html"><a href="introducción-a-r.html#rtools"><i class="fa fa-check"></i><b>2.1.3</b> RTools</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introducción-a-r.html"><a href="introducción-a-r.html#qué-es-r"><i class="fa fa-check"></i><b>2.2</b> ¿Qué es R?</a></li>
<li class="chapter" data-level="2.3" data-path="introducción-a-r.html"><a href="introducción-a-r.html#qué-es-rstudio"><i class="fa fa-check"></i><b>2.3</b> ¿Qué es RStudio?</a></li>
<li class="chapter" data-level="2.4" data-path="introducción-a-r.html"><a href="introducción-a-r.html#qué-otros-ides-existen-para-r"><i class="fa fa-check"></i><b>2.4</b> ¿Qué otros IDE’s existen para R?</a></li>
<li class="chapter" data-level="2.5" data-path="introducción-a-r.html"><a href="introducción-a-r.html#diferencias-entre-paquetes-y-librerías"><i class="fa fa-check"></i><b>2.5</b> Diferencias entre paquetes y librerías</a></li>
<li class="chapter" data-level="2.6" data-path="introducción-a-r.html"><a href="introducción-a-r.html#tipos-de-lenguajes-de-programación"><i class="fa fa-check"></i><b>2.6</b> Tipos de lenguajes de programación</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="introducción-a-r.html"><a href="introducción-a-r.html#lenguaje-compilado"><i class="fa fa-check"></i><b>2.6.1</b> Lenguaje compilado</a></li>
<li class="chapter" data-level="2.6.2" data-path="introducción-a-r.html"><a href="introducción-a-r.html#lenguaje-interpretado"><i class="fa fa-check"></i><b>2.6.2</b> Lenguaje interpretado</a></li>
<li class="chapter" data-level="2.6.3" data-path="introducción-a-r.html"><a href="introducción-a-r.html#lenguaje-intermedio"><i class="fa fa-check"></i><b>2.6.3</b> Lenguaje intermedio</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="introducción-a-r.html"><a href="introducción-a-r.html#paradigmas-de-programación"><i class="fa fa-check"></i><b>2.7</b> Paradigmas de programación</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="introducción-a-r.html"><a href="introducción-a-r.html#programación-orientado-a-objetos"><i class="fa fa-check"></i><b>2.7.1</b> Programación Orientado a Objetos</a></li>
<li class="chapter" data-level="2.7.2" data-path="introducción-a-r.html"><a href="introducción-a-r.html#programación-funcional"><i class="fa fa-check"></i><b>2.7.2</b> Programación Funcional</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="introducción-a-r.html"><a href="introducción-a-r.html#ambiente-de-trabajo-en-rstudio"><i class="fa fa-check"></i><b>2.8</b> Ambiente de trabajo en RStudio</a></li>
<li class="chapter" data-level="2.9" data-path="introducción-a-r.html"><a href="introducción-a-r.html#mi-primer-hello-world"><i class="fa fa-check"></i><b>2.9</b> Mi primer “Hello world”</a></li>
<li class="chapter" data-level="2.10" data-path="introducción-a-r.html"><a href="introducción-a-r.html#tipos-de-datos-en-r"><i class="fa fa-check"></i><b>2.10</b> Tipos de datos en R</a></li>
<li class="chapter" data-level="2.11" data-path="introducción-a-r.html"><a href="introducción-a-r.html#tipos-de-estructuras-de-datos"><i class="fa fa-check"></i><b>2.11</b> Tipos de estructuras de datos</a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="introducción-a-r.html"><a href="introducción-a-r.html#asignación-de-objetos"><i class="fa fa-check"></i><b>2.11.1</b> Asignación de objetos</a></li>
<li class="chapter" data-level="2.11.2" data-path="introducción-a-r.html"><a href="introducción-a-r.html#vector"><i class="fa fa-check"></i><b>2.11.2</b> Vector</a></li>
<li class="chapter" data-level="2.11.3" data-path="introducción-a-r.html"><a href="introducción-a-r.html#factor"><i class="fa fa-check"></i><b>2.11.3</b> Factor</a></li>
<li class="chapter" data-level="2.11.4" data-path="introducción-a-r.html"><a href="introducción-a-r.html#matrix"><i class="fa fa-check"></i><b>2.11.4</b> Matrix</a></li>
<li class="chapter" data-level="2.11.5" data-path="introducción-a-r.html"><a href="introducción-a-r.html#data-frame"><i class="fa fa-check"></i><b>2.11.5</b> Data Frame</a></li>
<li class="chapter" data-level="2.11.6" data-path="introducción-a-r.html"><a href="introducción-a-r.html#listas"><i class="fa fa-check"></i><b>2.11.6</b> Listas</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="introducción-a-r.html"><a href="introducción-a-r.html#lectura-escritura-de-datos-.csv-.xlsx-.rdata-.rds"><i class="fa fa-check"></i><b>2.12</b> Lectura / escritura de datos (.csv, .xlsx, .RData, .rds)</a>
<ul>
<li class="chapter" data-level="2.12.1" data-path="introducción-a-r.html"><a href="introducción-a-r.html#csv"><i class="fa fa-check"></i><b>2.12.1</b> CSV</a></li>
<li class="chapter" data-level="2.12.2" data-path="introducción-a-r.html"><a href="introducción-a-r.html#excel"><i class="fa fa-check"></i><b>2.12.2</b> EXCEL</a></li>
<li class="chapter" data-level="2.12.3" data-path="introducción-a-r.html"><a href="introducción-a-r.html#rds"><i class="fa fa-check"></i><b>2.12.3</b> RDS</a></li>
<li class="chapter" data-level="2.12.4" data-path="introducción-a-r.html"><a href="introducción-a-r.html#rdata"><i class="fa fa-check"></i><b>2.12.4</b> RDATA</a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="introducción-a-r.html"><a href="introducción-a-r.html#ejercicios"><i class="fa fa-check"></i><b>2.13</b> Ejercicios:</a>
<ul>
<li class="chapter" data-level="2.13.1" data-path="introducción-a-r.html"><a href="introducción-a-r.html#ejercicio-1"><i class="fa fa-check"></i><b>2.13.1</b> Ejercicio 1:</a></li>
<li class="chapter" data-level="2.13.2" data-path="introducción-a-r.html"><a href="introducción-a-r.html#ejercicio-2"><i class="fa fa-check"></i><b>2.13.2</b> Ejercicio 2:</a></li>
<li class="chapter" data-level="2.13.3" data-path="introducción-a-r.html"><a href="introducción-a-r.html#ejercicio-3"><i class="fa fa-check"></i><b>2.13.3</b> Ejercicio 3:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programando-con-r.html"><a href="programando-con-r.html"><i class="fa fa-check"></i><b>3</b> Programando con R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="programando-con-r.html"><a href="programando-con-r.html#operadores-relacionales-y-lógicos"><i class="fa fa-check"></i><b>3.1</b> Operadores relacionales y lógicos</a></li>
<li class="chapter" data-level="3.2" data-path="programando-con-r.html"><a href="programando-con-r.html#consultas-lógicas"><i class="fa fa-check"></i><b>3.2</b> Consultas lógicas</a></li>
<li class="chapter" data-level="3.3" data-path="programando-con-r.html"><a href="programando-con-r.html#control-de-flujo"><i class="fa fa-check"></i><b>3.3</b> Control de flujo</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="programando-con-r.html"><a href="programando-con-r.html#condicionales-if-else"><i class="fa fa-check"></i><b>3.3.1</b> Condicionales (if, else)</a></li>
<li class="chapter" data-level="3.3.2" data-path="programando-con-r.html"><a href="programando-con-r.html#bucles-while-for"><i class="fa fa-check"></i><b>3.3.2</b> Bucles (while, for)</a></li>
<li class="chapter" data-level="3.3.3" data-path="programando-con-r.html"><a href="programando-con-r.html#control-de-flujo-1"><i class="fa fa-check"></i><b>3.3.3</b> Control de flujo</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="programando-con-r.html"><a href="programando-con-r.html#funciones"><i class="fa fa-check"></i><b>3.4</b> Funciones</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="programando-con-r.html"><a href="programando-con-r.html#ejercicios-1"><i class="fa fa-check"></i><b>3.4.1</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="programando-con-r.html"><a href="programando-con-r.html#funciones-de-la-familia-apply"><i class="fa fa-check"></i><b>3.5</b> Funciones de la familia apply</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="programando-con-r.html"><a href="programando-con-r.html#apply"><i class="fa fa-check"></i><b>3.5.1</b> apply():</a></li>
<li class="chapter" data-level="3.5.2" data-path="programando-con-r.html"><a href="programando-con-r.html#tapply"><i class="fa fa-check"></i><b>3.5.2</b> tapply()</a></li>
<li class="chapter" data-level="3.5.3" data-path="programando-con-r.html"><a href="programando-con-r.html#lapply"><i class="fa fa-check"></i><b>3.5.3</b> lapply()</a></li>
<li class="chapter" data-level="3.5.4" data-path="programando-con-r.html"><a href="programando-con-r.html#sapply"><i class="fa fa-check"></i><b>3.5.4</b> sapply()</a></li>
<li class="chapter" data-level="3.5.5" data-path="programando-con-r.html"><a href="programando-con-r.html#vapply"><i class="fa fa-check"></i><b>3.5.5</b> vapply()</a></li>
<li class="chapter" data-level="3.5.6" data-path="programando-con-r.html"><a href="programando-con-r.html#rapply"><i class="fa fa-check"></i><b>3.5.6</b> rapply()</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="programando-con-r.html"><a href="programando-con-r.html#gráficos"><i class="fa fa-check"></i><b>3.6</b> Gráficos</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="programando-con-r.html"><a href="programando-con-r.html#gráficos-de-dispersión"><i class="fa fa-check"></i><b>3.6.1</b> Gráficos de dispersión</a></li>
<li class="chapter" data-level="3.6.2" data-path="programando-con-r.html"><a href="programando-con-r.html#gráficos-de-líneas"><i class="fa fa-check"></i><b>3.6.2</b> Gráficos de líneas</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="programando-con-r.html"><a href="programando-con-r.html#estilo-tidyverse"><i class="fa fa-check"></i><b>3.7</b> Estilo tidyverse</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="programando-con-r.html"><a href="programando-con-r.html#data-transformation-con-dplyr"><i class="fa fa-check"></i><b>3.7.1</b> Data Transformation con dplyr</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="programando-con-r.html"><a href="programando-con-r.html#gráficos-con-ggplot"><i class="fa fa-check"></i><b>3.8</b> Gráficos con ggplot</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="programando-con-r.html"><a href="programando-con-r.html#introducción"><i class="fa fa-check"></i><b>3.8.1</b> Introducción</a></li>
<li class="chapter" data-level="3.8.2" data-path="programando-con-r.html"><a href="programando-con-r.html#primeros-pasos"><i class="fa fa-check"></i><b>3.8.2</b> Primeros pasos</a></li>
<li class="chapter" data-level="3.8.3" data-path="programando-con-r.html"><a href="programando-con-r.html#mapeos-estéticos"><i class="fa fa-check"></i><b>3.8.3</b> Mapeos estéticos</a></li>
<li class="chapter" data-level="3.8.4" data-path="programando-con-r.html"><a href="programando-con-r.html#problemas-comunes"><i class="fa fa-check"></i><b>3.8.4</b> Problemas comunes</a></li>
<li class="chapter" data-level="3.8.5" data-path="programando-con-r.html"><a href="programando-con-r.html#separar-en-facetas"><i class="fa fa-check"></i><b>3.8.5</b> Separar en facetas</a></li>
<li class="chapter" data-level="3.8.6" data-path="programando-con-r.html"><a href="programando-con-r.html#objetos-geométricos"><i class="fa fa-check"></i><b>3.8.6</b> Objetos geométricos</a></li>
<li class="chapter" data-level="3.8.7" data-path="programando-con-r.html"><a href="programando-con-r.html#transformaciones-estadísticas"><i class="fa fa-check"></i><b>3.8.7</b> Transformaciones estadísticas</a></li>
<li class="chapter" data-level="3.8.8" data-path="programando-con-r.html"><a href="programando-con-r.html#ajustes-de-posición"><i class="fa fa-check"></i><b>3.8.8</b> Ajustes de posición</a></li>
<li class="chapter" data-level="3.8.9" data-path="programando-con-r.html"><a href="programando-con-r.html#sistemas-de-coordenadas"><i class="fa fa-check"></i><b>3.8.9</b> Sistemas de coordenadas</a></li>
<li class="chapter" data-level="3.8.10" data-path="programando-con-r.html"><a href="programando-con-r.html#la-gramática-de-gráficos-en-capas"><i class="fa fa-check"></i><b>3.8.10</b> La gramática de gráficos en capas</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>4</b> Rmarkdown</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rmarkdown.html"><a href="rmarkdown.html#introducción-1"><i class="fa fa-check"></i><b>4.1</b> Introducción</a></li>
<li class="chapter" data-level="4.2" data-path="rmarkdown.html"><a href="rmarkdown.html#sintaxis-de-markdown"><i class="fa fa-check"></i><b>4.2</b> Sintaxis de Markdown</a></li>
<li class="chapter" data-level="4.3" data-path="rmarkdown.html"><a href="rmarkdown.html#codigormd"><i class="fa fa-check"></i><b>4.3</b> Inclusión de código R</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="rmarkdown.html"><a href="rmarkdown.html#gráficos-1"><i class="fa fa-check"></i><b>4.3.1</b> Gráficos</a></li>
<li class="chapter" data-level="4.3.2" data-path="rmarkdown.html"><a href="rmarkdown.html#opcodigo"><i class="fa fa-check"></i><b>4.3.2</b> Opciones de bloques de código</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="rmarkdown.html"><a href="rmarkdown.html#tablas"><i class="fa fa-check"></i><b>4.4</b> Tablas</a></li>
<li class="chapter" data-level="4.5" data-path="rmarkdown.html"><a href="rmarkdown.html#yaml"><i class="fa fa-check"></i><b>4.5</b> Cabecera YAML</a></li>
<li class="chapter" data-level="4.6" data-path="rmarkdown.html"><a href="rmarkdown.html#spin"><i class="fa fa-check"></i><b>4.6</b> Spin</a></li>
<li class="chapter" data-level="4.7" data-path="rmarkdown.html"><a href="rmarkdown.html#extensiones-rmarkdown-de-pandoc"><i class="fa fa-check"></i><b>4.7</b> Extensiones RMarkdown de pandoc</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="control-de-versiones.html"><a href="control-de-versiones.html"><i class="fa fa-check"></i><b>5</b> Control de versiones</a>
<ul>
<li class="chapter" data-level="5.1" data-path="control-de-versiones.html"><a href="control-de-versiones.html#git"><i class="fa fa-check"></i><b>5.1</b> Git</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="control-de-versiones.html"><a href="control-de-versiones.html#configuración"><i class="fa fa-check"></i><b>5.1.1</b> Configuración</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="control-de-versiones.html"><a href="control-de-versiones.html#inicializando-un-repositorio"><i class="fa fa-check"></i><b>5.2</b> Inicializando un repositorio</a></li>
<li class="chapter" data-level="5.3" data-path="control-de-versiones.html"><a href="control-de-versiones.html#commiting"><i class="fa fa-check"></i><b>5.3</b> Commiting</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="control-de-versiones.html"><a href="control-de-versiones.html#historial-de-registros"><i class="fa fa-check"></i><b>5.3.1</b> Historial de registros</a></li>
<li class="chapter" data-level="5.3.2" data-path="control-de-versiones.html"><a href="control-de-versiones.html#conectando-repositorio-local-con-repositorio-en-github"><i class="fa fa-check"></i><b>5.3.2</b> Conectando repositorio local con repositorio en Github</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="control-de-versiones.html"><a href="control-de-versiones.html#sincronizar-rstudio-y-github"><i class="fa fa-check"></i><b>5.4</b> Sincronizar RStudio y GitHub</a></li>
<li class="chapter" data-level="5.5" data-path="control-de-versiones.html"><a href="control-de-versiones.html#pull-request"><i class="fa fa-check"></i><b>5.5</b> Pull request</a></li>
<li class="chapter" data-level="5.6" data-path="control-de-versiones.html"><a href="control-de-versiones.html#merge-conflicts"><i class="fa fa-check"></i><b>5.6</b> Merge conflicts</a></li>
<li class="chapter" data-level="5.7" data-path="control-de-versiones.html"><a href="control-de-versiones.html#resumen"><i class="fa fa-check"></i><b>5.7</b> Resumen</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="control-de-versiones.html"><a href="control-de-versiones.html#cómo-puedo-hacer-un-readme"><i class="fa fa-check"></i><b>5.7.1</b> ¿Cómo puedo hacer un README?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="introducción-a-datos-espaciales.html"><a href="introducción-a-datos-espaciales.html"><i class="fa fa-check"></i><b>6</b> Introducción a datos espaciales</a>
<ul>
<li class="chapter" data-level="6.1" data-path="introducción-a-datos-espaciales.html"><a href="introducción-a-datos-espaciales.html#introducción-a-datos-espaciales-1"><i class="fa fa-check"></i><b>6.1</b> Introducción a datos espaciales</a></li>
<li class="chapter" data-level="6.2" data-path="introducción-a-datos-espaciales.html"><a href="introducción-a-datos-espaciales.html#introducción-a-datos-espaciales-2"><i class="fa fa-check"></i><b>6.2</b> Introducción a datos espaciales</a></li>
<li class="chapter" data-level="6.3" data-path="introducción-a-datos-espaciales.html"><a href="introducción-a-datos-espaciales.html#introducción-a-datos-espaciales-3"><i class="fa fa-check"></i><b>6.3</b> Introducción a datos espaciales</a></li>
<li class="chapter" data-level="6.4" data-path="introducción-a-datos-espaciales.html"><a href="introducción-a-datos-espaciales.html#introducción-a-datos-espaciales-4"><i class="fa fa-check"></i><b>6.4</b> Introducción a datos espaciales</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ejercicios-2.html"><a href="ejercicios-2.html"><i class="fa fa-check"></i><b>7</b> Ejercicios</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ejercicios-2.html"><a href="ejercicios-2.html#parte-1"><i class="fa fa-check"></i><b>7.1</b> Parte 1</a></li>
<li class="chapter" data-level="7.2" data-path="ejercicios-2.html"><a href="ejercicios-2.html#parte-2"><i class="fa fa-check"></i><b>7.2</b> Parte 2</a></li>
<li class="chapter" data-level="7.3" data-path="ejercicios-2.html"><a href="ejercicios-2.html#parte-3"><i class="fa fa-check"></i><b>7.3</b> Parte 3</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://classroom.google.com/u/3/c/MzQxNzA3MDAzODE5" target="blank">Classroom del curso</a></li>
<li><a href="https://github.com/ryali93/ProgramacionR/" target="blank">Repositorio en Github</a></li> 

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Programación</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="programando-con-r" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Programando con R</h1>
<div id="operadores-relacionales-y-lógicos" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Operadores relacionales y lógicos</h2>
<p>Los operadores de comparación o relacionales están diseñados para comparar objetos. El resultado de estas comparaciones son de tipo booleano. La siguiente tabla resume los operadores relacionales de R.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="programando-con-r.html#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">Operador</th>
<th align="center">Resultado</th>
<th align="center">Comparación</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>x &gt; 3</code></td>
<td align="center"><code>c(F, F, F, T, T)</code></td>
<td align="center">Mayor que</td>
</tr>
<tr class="even">
<td align="center"><code>x &gt;= 3</code></td>
<td align="center"><code>c(F, F, T, T, T)</code></td>
<td align="center">Mayor o igual que</td>
</tr>
<tr class="odd">
<td align="center"><code>x &lt; 3</code></td>
<td align="center"><code>c(T, T, F, F, F)</code></td>
<td align="center">Menor que</td>
</tr>
<tr class="even">
<td align="center"><code>x &lt;= 3</code></td>
<td align="center"><code>c(T, T, T, F, F)</code></td>
<td align="center">Menor o igual que</td>
</tr>
<tr class="odd">
<td align="center"><code>x == 3</code></td>
<td align="center"><code>c(F, F, T, F, F)</code></td>
<td align="center">Igual a</td>
</tr>
<tr class="even">
<td align="center"><code>x != 3</code></td>
<td align="center"><code>c(T, T, F, T, T)</code></td>
<td align="center">Diferente de</td>
</tr>
<tr class="odd">
<td align="center"><code>x = 3</code></td>
<td align="center"></td>
<td align="center">Igual que &lt;-</td>
</tr>
</tbody>
</table>
<p>Se puede utilizar <code>%in%</code> para preguntar si uno o varios elementos se encuentran en otro, devolviendo lógicos.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="programando-con-r.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>) </span>
<span id="cb2-2"><a href="programando-con-r.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb2-3"><a href="programando-con-r.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>) </span></code></pre></div>
<p>Los operadores booleanos o lógicos en R se utilizan para especificar múltiples condiciones entre objetos. Estas comparaciones devuelven valores <code>TRUE</code> o <code>FALSE</code>.</p>
<p>Puedes combinar evaluaciones lógicas con <strong>&amp;</strong>, <strong>|</strong>, <strong>xor</strong>, <strong>!</strong>, <strong>any</strong>, y
<strong>all</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="programando-con-r.html#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> x <span class="sc">&lt;</span> <span class="dv">9</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">Operador</th>
<th align="center">Evaluación</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>a &amp; b</code></td>
<td align="center">Tanto a como b son VERDADEROS</td>
</tr>
<tr class="even">
<td align="center"><code>a | b</code></td>
<td align="center">Al menos uno de a y b es VERDADERO (o)</td>
</tr>
<tr class="odd">
<td align="center"><code>xor(a, b)</code></td>
<td align="center">a es VERDADERO o b es VERDADERO, pero no ambos</td>
</tr>
<tr class="even">
<td align="center"><code>!a</code></td>
<td align="center">No a (VERDADERO va a FALSO, FALSO va a VERDADERO)</td>
</tr>
<tr class="odd">
<td align="center"><code>any(a, b, c)</code></td>
<td align="center">Al menos uno de a, b o c es VERDADERO</td>
</tr>
<tr class="even">
<td align="center"><code>all(a, b, c)</code></td>
<td align="center">Cada uno de a, b y c es VERDADERO</td>
</tr>
</tbody>
</table>
</div>
<div id="consultas-lógicas" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Consultas lógicas</h2>
<p>Combinar pruebas lógicas con subconjuntos es una práctica común</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="programando-con-r.html#cb4-1" aria-hidden="true" tabindex="-1"></a>x_ceros <span class="ot">&lt;-</span> diamonds<span class="sc">$</span>x <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb4-2"><a href="programando-con-r.html#cb4-2" aria-hidden="true" tabindex="-1"></a>diamonds[x_ceros, ]</span></code></pre></div>
<pre><code>## # A tibble: 8 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  1.07 Ideal     F     SI2      61.6    56  4954     0  6.62     0
## 2  1    Very Good H     VS2      63.3    53  5139     0  0        0
## 3  1.14 Fair      G     VS1      57.5    67  6381     0  0        0
## 4  1.56 Ideal     G     VS2      62.2    54 12800     0  0        0
## 5  1.2  Premium   D     VVS1     62.1    59 15686     0  0        0
## 6  2.25 Premium   H     SI2      62.8    59 18034     0  0        0
## 7  0.71 Good      F     SI2      64.1    60  2130     0  0        0
## 8  0.71 Good      F     SI2      64.1    60  2130     0  0        0</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="programando-con-r.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ver resultados</span></span>
<span id="cb6-2"><a href="programando-con-r.html#cb6-2" aria-hidden="true" tabindex="-1"></a>diamonds[diamonds<span class="sc">$</span>x <span class="sc">&gt;</span> <span class="dv">10</span>, ]</span></code></pre></div>
<pre><code>## # A tibble: 5 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  4.01 Premium   I     I1       61      61 15223  10.1 10.1   6.17
## 2  4.01 Premium   J     I1       62.5    62 15223  10.0  9.94  6.24
## 3  4    Very Good I     I1       63.3    58 15984  10.0  9.94  6.31
## 4  5.01 Fair      J     I1       65.5    59 18018  10.7 10.5   6.98
## 5  4.5  Fair      J     I1       65.8    58 18531  10.2 10.2   6.72</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="programando-con-r.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardar un nuevo data.frame</span></span>
<span id="cb8-2"><a href="programando-con-r.html#cb8-2" aria-hidden="true" tabindex="-1"></a>big <span class="ot">&lt;-</span> diamonds[diamonds<span class="sc">$</span>x <span class="sc">&gt;</span> <span class="dv">10</span>, ]</span>
<span id="cb8-3"><a href="programando-con-r.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Sobreescribir el dataset existente (Cuidado!)</span></span>
<span id="cb8-4"><a href="programando-con-r.html#cb8-4" aria-hidden="true" tabindex="-1"></a>diamonds <span class="ot">&lt;-</span> diamonds[diamonds<span class="sc">$</span>x <span class="sc">&lt;</span> <span class="dv">10</span>, ]</span></code></pre></div>
</div>
<div id="control-de-flujo" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Control de flujo</h2>
<p>¿Quieres saltar este capítulo? Hazlo si puedes responder estas preguntas.</p>
<ul>
<li>Cuál es la diferencia entre <code>if</code> e <code>ifelse()</code>?</li>
<li>En el siguiente código, cuál será el valor de <code>y</code> si <code>x</code> es <code>TRUE</code>? Y cuál sería si <code>x</code> es <code>FALSE</code>? Y cuál si <code>x</code> es <code>NA</code>?</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="programando-con-r.html#cb9-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="cf">if</span> (x) <span class="dv">3</span></span></code></pre></div>
<p style="text-align: justify;">
Los comandos de control de flujo son una forma de modificar la secuencia de ejecución del código. Existen 2 herramientas principales de flujo de control: Opciones y bucles. Las opciones, como las declaraciones condicionales <code>if</code> y las llamadas <code>switch()</code>, permiten ejecutar código diferente según la entrada. Los bucles, como <code>for</code> y <code>while</code>, le permiten ejecutar código repetidamente, generalmente con opciones cambiantes.
</p>
<div id="condicionales-if-else" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Condicionales (if, else)</h3>
<p>La toma de decisiones es una parte importante de la programación. Esto se puede lograr en la programación R usando la nomenclatura condicional if else.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="programando-con-r.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (expresion) {</span>
<span id="cb10-2"><a href="programando-con-r.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  declaracion1</span>
<span id="cb10-3"><a href="programando-con-r.html#cb10-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb10-4"><a href="programando-con-r.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  declaracion2</span>
<span id="cb10-5"><a href="programando-con-r.html#cb10-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Si expresion es <code>TRUE</code>, la instrucción se ejecuta. Pero si es <code>FALSO</code>, no pasa nada.</li>
<li>Aquí, expresion puede ser un vector lógico o numérico, pero solo se tiene en cuenta el primer elemento.</li>
<li>En el caso del vector numérico, cero se toma como <code>FALSO</code>, el resto como VERDADERO.</li>
<li>La parte <strong>else</strong> es opcional y solo se evalúa si <strong>expresion</strong> es <code>FALSE</code>.</li>
<li>Es importante tener en cuenta que <strong>else</strong> debe estar en la misma línea que las llaves de cierre de la instrucción if.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="programando-con-r.html#cb11-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-2"><a href="programando-con-r.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb11-3"><a href="programando-con-r.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Numero negativo&quot;</span>)</span>
<span id="cb11-4"><a href="programando-con-r.html#cb11-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (x <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb11-5"><a href="programando-con-r.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Numero positivo&quot;</span>)</span>
<span id="cb11-6"><a href="programando-con-r.html#cb11-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb11-7"><a href="programando-con-r.html#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Cero&quot;</span>)</span>
<span id="cb11-8"><a href="programando-con-r.html#cb11-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Cero&quot;</code></pre>
<p>Comparación entre Python y R</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="programando-con-r.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">## PYTHON</span></span>
<span id="cb13-2"><a href="programando-con-r.html#cb13-2" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> [<span class="dv">15</span>, <span class="dv">22</span>, <span class="dv">30</span>]</span>
<span id="cb13-3"><a href="programando-con-r.html#cb13-3" aria-hidden="true" tabindex="-1"></a>suelo <span class="op">=</span> [<span class="st">&quot;seco&quot;</span>, <span class="st">&quot;humedo&quot;</span>, <span class="st">&quot;charcos&quot;</span>]</span>
<span id="cb13-4"><a href="programando-con-r.html#cb13-4" aria-hidden="true" tabindex="-1"></a>valtemp <span class="op">=</span> temp[<span class="dv">0</span>]</span>
<span id="cb13-5"><a href="programando-con-r.html#cb13-5" aria-hidden="true" tabindex="-1"></a>valsuelo <span class="op">=</span> suelo[<span class="dv">2</span>]</span>
<span id="cb13-6"><a href="programando-con-r.html#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="dv">12</span><span class="op">&lt;=</span> valtemp <span class="op">&lt;</span> <span class="dv">22</span> <span class="kw">and</span> valsuelo <span class="op">==</span><span class="st">&quot;seco&quot;</span>: </span>
<span id="cb13-7"><a href="programando-con-r.html#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&quot;Cielo despejado&quot;</span>)</span>
<span id="cb13-8"><a href="programando-con-r.html#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> valtemp <span class="op">==</span> <span class="dv">22</span> <span class="kw">or</span> valsuelo <span class="op">==</span> <span class="st">&quot;humedo&quot;</span>:</span>
<span id="cb13-9"><a href="programando-con-r.html#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&quot;lluvia leve&quot;</span>)</span>
<span id="cb13-10"><a href="programando-con-r.html#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> valtemp <span class="op">&gt;</span> <span class="dv">22</span> <span class="kw">and</span> valsuelo <span class="op">==</span><span class="st">&quot;charcos&quot;</span>:</span>
<span id="cb13-11"><a href="programando-con-r.html#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&quot;lluvia severa&quot;</span>)</span>
<span id="cb13-12"><a href="programando-con-r.html#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb13-13"><a href="programando-con-r.html#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&quot; Faltan datos&quot;</span>)</span></code></pre></div>
<pre><code>##  Faltan datos</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="programando-con-r.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## R</span></span>
<span id="cb15-2"><a href="programando-con-r.html#cb15-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">22</span>, <span class="dv">30</span>)</span>
<span id="cb15-3"><a href="programando-con-r.html#cb15-3" aria-hidden="true" tabindex="-1"></a>suelo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;seco&quot;</span>, <span class="st">&quot;humedo&quot;</span>, <span class="st">&quot;charcos&quot;</span>)</span>
<span id="cb15-4"><a href="programando-con-r.html#cb15-4" aria-hidden="true" tabindex="-1"></a>valtemp <span class="ot">&lt;-</span> temp[<span class="dv">1</span>]</span>
<span id="cb15-5"><a href="programando-con-r.html#cb15-5" aria-hidden="true" tabindex="-1"></a>valsuelo <span class="ot">&lt;-</span> suelo[<span class="dv">3</span>]</span>
<span id="cb15-6"><a href="programando-con-r.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (valtemp <span class="sc">%in%</span> <span class="dv">12</span><span class="sc">:</span><span class="dv">22</span> <span class="sc">&amp;</span> valsuelo <span class="sc">==</span> <span class="st">&quot;seco&quot;</span>) {</span>
<span id="cb15-7"><a href="programando-con-r.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Cielo despejado&quot;</span>)</span>
<span id="cb15-8"><a href="programando-con-r.html#cb15-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (valtemp <span class="sc">==</span> <span class="dv">22</span> <span class="sc">|</span> valsuelo <span class="sc">==</span> <span class="st">&quot;humedo&quot;</span>) {</span>
<span id="cb15-9"><a href="programando-con-r.html#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">lluvia leve&quot;</span>)</span>
<span id="cb15-10"><a href="programando-con-r.html#cb15-10" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (valtemp <span class="sc">&gt;</span> <span class="dv">22</span> <span class="sc">&amp;</span> valsuelo <span class="sc">==</span> <span class="st">&quot;charcos&quot;</span>) {</span>
<span id="cb15-11"><a href="programando-con-r.html#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">lluvia severa&quot;</span>)</span>
<span id="cb15-12"><a href="programando-con-r.html#cb15-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb15-13"><a href="programando-con-r.html#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Faltan datos&quot;</span>)</span>
<span id="cb15-14"><a href="programando-con-r.html#cb15-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;\nFaltan datos&quot;</code></pre>
</div>
<div id="bucles-while-for" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Bucles (while, for)</h3>
<p style="text-align: justify;">
Los bucles son una de las estructuras fundamentales en la programación. Los bucles permiten iterar sobre cada elemento en una secuencia, uno a la vez, y hacer algo con esos elementos.
</p>
<div id="for" class="section level4" number="3.3.2.1">
<h4><span class="header-section-number">3.3.2.1</span> for</h4>
<p style="text-align: justify;">
Un bucle <strong>for</strong> es muy valioso cuando necesitamos iterar sobre una lista de elementos o un rango de números. Loop se puede usar para iterar sobre una lista, marco de datos, vector, matriz o cualquier otro objeto. Los tirantes y el corchete son obligatorios.
</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="programando-con-r.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (valor <span class="cf">in</span> secuencia)</span>
<span id="cb17-2"><a href="programando-con-r.html#cb17-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb17-3"><a href="programando-con-r.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  cuerpo</span>
<span id="cb17-4"><a href="programando-con-r.html#cb17-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="programando-con-r.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creando un vector de frutas</span></span>
<span id="cb18-2"><a href="programando-con-r.html#cb18-2" aria-hidden="true" tabindex="-1"></a>frutas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Apple&quot;</span>, <span class="st">&quot;Orange&quot;</span>, <span class="st">&quot;Passion fruit&quot;</span>, <span class="st">&quot;Banana&quot;</span>)</span>
<span id="cb18-3"><a href="programando-con-r.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Declarando el bucle for</span></span>
<span id="cb18-4"><a href="programando-con-r.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> frutas) {</span>
<span id="cb18-5"><a href="programando-con-r.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb18-6"><a href="programando-con-r.html#cb18-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Apple&quot;
## [1] &quot;Orange&quot;
## [1] &quot;Passion fruit&quot;
## [1] &quot;Banana&quot;</code></pre>
</div>
<div id="while" class="section level4" number="3.3.2.2">
<h4><span class="header-section-number">3.3.2.2</span> while</h4>
<p>Un bucle <strong>while</strong> es una declaración que continúa ejecutándose <strong>mientras</strong> se cumple una condición. La sintaxis para un ciclo while es la siguiente:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="programando-con-r.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (condición) {</span>
<span id="cb20-2"><a href="programando-con-r.html#cb20-2" aria-hidden="true" tabindex="-1"></a>  cuerpo</span>
<span id="cb20-3"><a href="programando-con-r.html#cb20-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="programando-con-r.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creando la expresión con valor 1</span></span>
<span id="cb21-2"><a href="programando-con-r.html#cb21-2" aria-hidden="true" tabindex="-1"></a>inicio <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-3"><a href="programando-con-r.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Creando el loop</span></span>
<span id="cb21-4"><a href="programando-con-r.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (inicio <span class="sc">&lt;=</span> <span class="dv">5</span>) {</span>
<span id="cb21-5"><a href="programando-con-r.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ver donde estamos</span></span>
<span id="cb21-6"><a href="programando-con-r.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Este es el ciclo número &quot;</span>, inicio)</span>
<span id="cb21-7"><a href="programando-con-r.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Agregar 1 a la variable inicio despues de cada iteracion</span></span>
<span id="cb21-8"><a href="programando-con-r.html#cb21-8" aria-hidden="true" tabindex="-1"></a>  inicio <span class="ot">&lt;-</span> inicio <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb21-9"><a href="programando-con-r.html#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(inicio)</span>
<span id="cb21-10"><a href="programando-con-r.html#cb21-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Este es el ciclo número  1[1] 2
## Este es el ciclo número  2[1] 3
## Este es el ciclo número  3[1] 4
## Este es el ciclo número  4[1] 5
## Este es el ciclo número  5[1] 6</code></pre>
</div>
</div>
<div id="control-de-flujo-1" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Control de flujo</h3>
<div id="break" class="section level4" number="3.3.3.1">
<h4><span class="header-section-number">3.3.3.1</span> break</h4>
<p>Se usa una declaración <code>break</code> dentro de un bucle (repeat, for, while) para detener las iteraciones y hacer fluir el control fuera del bucle.</p>
<p>En una situación de bucle anidado, donde hay un bucle dentro de otro bucle, esta declaración sale del bucle más interno que se está evaluando.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="programando-con-r.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (test_expression) {</span>
<span id="cb23-2"><a href="programando-con-r.html#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">break</span></span>
<span id="cb23-3"><a href="programando-con-r.html#cb23-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Nota: la instrucción break también se puede usar dentro de la rama <code>else</code> de la instrucción <code>if</code> … <code>else</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="programando-con-r.html#cb24-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb24-2"><a href="programando-con-r.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (val <span class="cf">in</span> x) {</span>
<span id="cb24-3"><a href="programando-con-r.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (val <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb24-4"><a href="programando-con-r.html#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb24-5"><a href="programando-con-r.html#cb24-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-6"><a href="programando-con-r.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(val)</span>
<span id="cb24-7"><a href="programando-con-r.html#cb24-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2</code></pre>
<p>En este ejemplo, iteramos sobre el vector x, que tiene números consecutivos del 1 al 5.</p>
<p>Dentro del ciclo <code>for</code> hemos usado una condición <code>if</code> para romper si el valor actual es igual a 3.</p>
<p>Como podemos ver en la salida, el bucle termina cuando encuentra la declaración <code>break</code>.</p>
</div>
<div id="next" class="section level4" number="3.3.3.2">
<h4><span class="header-section-number">3.3.3.2</span> next</h4>
<p>Una declaración <code>next</code> es útil cuando queremos omitir la iteración actual de un ciclo sin terminarlo. Al encontrar el siguiente, R omite una evaluación adicional y comienza la siguiente iteración del ciclo.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="programando-con-r.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (test_condition) {</span>
<span id="cb26-2"><a href="programando-con-r.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">next</span></span>
<span id="cb26-3"><a href="programando-con-r.html#cb26-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="programando-con-r.html#cb27-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb27-2"><a href="programando-con-r.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (val <span class="cf">in</span> x) {</span>
<span id="cb27-3"><a href="programando-con-r.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (val <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb27-4"><a href="programando-con-r.html#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb27-5"><a href="programando-con-r.html#cb27-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-6"><a href="programando-con-r.html#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(val)</span>
<span id="cb27-7"><a href="programando-con-r.html#cb27-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 4
## [1] 5</code></pre>
<p>En el ejemplo anterior, usamos la siguiente declaración dentro de una condición para verificar si el valor es igual a 3.</p>
<p>Si el valor es igual a 3, la evaluación actual se detiene (el valor no se imprime) pero el ciclo continúa con la siguiente iteración.</p>
</div>
</div>
</div>
<div id="funciones" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Funciones</h2>
<p style="text-align: justify;">
Una función, en un entorno de programación, es un conjunto de instrucciones. Un programador crea una función para evitar repetir la misma tarea o reducir la complejidad.
</p>
<p>Una función debería ser:</p>
<ul>
<li>Escrito para llevar a cabo una tarea específica</li>
<li>Puede o no incluir argumentos</li>
<li>Contener un cuerpo</li>
<li>Puede o no devolver uno o más valores</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="programando-con-r.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(argumentos) {</span>
<span id="cb29-2"><a href="programando-con-r.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cuerpo de la funcion</span></span>
<span id="cb29-3"><a href="programando-con-r.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  resultado <span class="ot">&lt;-</span> cuerpo</span>
<span id="cb29-4"><a href="programando-con-r.html#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="programando-con-r.html#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultado)</span>
<span id="cb29-6"><a href="programando-con-r.html#cb29-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Ejemplo:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="programando-con-r.html#cb30-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb30-2"><a href="programando-con-r.html#cb30-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb30-3"><a href="programando-con-r.html#cb30-3" aria-hidden="true" tabindex="-1"></a>suma <span class="ot">&lt;-</span> <span class="cf">function</span>(valor1, valor2) {</span>
<span id="cb30-4"><a href="programando-con-r.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  resultado <span class="ot">&lt;-</span> valor1 <span class="sc">+</span> valor2</span>
<span id="cb30-5"><a href="programando-con-r.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultado)</span>
<span id="cb30-6"><a href="programando-con-r.html#cb30-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-7"><a href="programando-con-r.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">suma</span>(a, b)</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<div id="ejercicios-1" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Ejercicios</h3>
<div id="ejercicio-1-1" class="section level4" number="3.4.1.1">
<h4><span class="header-section-number">3.4.1.1</span> Ejercicio 1:</h4>
<p style="text-align: justify;">
Cree una función que, dado un vector, imprima por pantalla la media y la desviación estándar, opcionalmente también imprimirá la mediana.
</p>
</div>
<div id="ejercicio-2-1" class="section level4" number="3.4.1.2">
<h4><span class="header-section-number">3.4.1.2</span> Ejercicio 2:</h4>
<ul>
<li>Agregar un argumento adicional, llamado <code>print_info</code>, que sea <code>TRUE</code> por defecto</li>
<li>Crea una condicional alrededor de la función <code>print()</code>, la cual debe ser ejecutada sólo si <code>print_info</code> es <code>TRUE</code></li>
<li>Prueba el código</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="programando-con-r.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finaliza la funcion pow_two()</span></span>
<span id="cb32-2"><a href="programando-con-r.html#cb32-2" aria-hidden="true" tabindex="-1"></a>pow_two <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb32-3"><a href="programando-con-r.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb32-4"><a href="programando-con-r.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(x, <span class="st">&quot;to the power two equals&quot;</span>, y))</span>
<span id="cb32-5"><a href="programando-con-r.html#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb32-6"><a href="programando-con-r.html#cb32-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
</div>
<div id="funciones-de-la-familia-apply" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Funciones de la familia apply</h2>
Los apply: apply, tapply, lapply, sapply, vapply, rapply
<p style="text-align: justify;">
Entonces, ¿cuáles son estas maravillosas funciones de aplicación y cómo funcionan? Creo que la mejor manera de descubrir cualquier cosa en R es aprender mediante la experimentación, utilizando datos y funciones vergonzosamente triviales.
</p>
<p>If you fire up your R console, type “??apply” and scroll down to the functions in the base package, you’ll see something like this:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="programando-con-r.html#cb33-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/earthquakes.csv&quot;</span>)</span>
<span id="cb33-2"><a href="programando-con-r.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d)</span>
<span id="cb33-3"><a href="programando-con-r.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<div id="apply" class="section level3" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> apply():</h3>
<p>Crea resúmenes sobre los ejes. 1: Sobre filas, 2: Sobre columnas</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="programando-con-r.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(d[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">2</span>, mean, <span class="at">na.rm =</span> T)</span>
<span id="cb34-2"><a href="programando-con-r.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(d[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">2</span>, median, <span class="at">na.rm =</span> T)</span>
<span id="cb34-3"><a href="programando-con-r.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(d[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">2</span>, summary)</span></code></pre></div>
</div>
<div id="tapply" class="section level3" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> tapply()</h3>
<p>Esta función trabaja sobre matrices o tablas desiguales y usa una variable de agrupamiento o índice.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="programando-con-r.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(d<span class="sc">$</span>Source)</span>
<span id="cb35-2"><a href="programando-con-r.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(d<span class="sc">$</span>Magnitude, d<span class="sc">$</span>Latitude, mean, <span class="at">na.rm =</span> T)</span>
<span id="cb35-3"><a href="programando-con-r.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(d<span class="sc">$</span>Magnitude, d<span class="sc">$</span>Source, mean, <span class="at">na.rm =</span> T)</span>
<span id="cb35-4"><a href="programando-con-r.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(d, <span class="fu">tapply</span>(Magnitude, Latitude, mean, <span class="at">na.rm =</span> T))</span>
<span id="cb35-5"><a href="programando-con-r.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(d, <span class="fu">tapply</span>(Magnitude, Longitude, summary))</span>
<span id="cb35-6"><a href="programando-con-r.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(d, <span class="fu">tapply</span>(Magnitude, Source, summary))</span></code></pre></div>
</div>
<div id="lapply" class="section level3" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> lapply()</h3>
<p>Esta función es aplicable a vectores y listas y permite generar resúmenes como listas</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="programando-con-r.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d)</span>
<span id="cb36-2"><a href="programando-con-r.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span>
<span id="cb36-3"><a href="programando-con-r.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(d, mean, <span class="at">na.rm =</span> T)</span>
<span id="cb36-4"><a href="programando-con-r.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">data.frame</span>(<span class="at">a =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">b =</span> <span class="dv">15</span><span class="sc">:</span><span class="dv">25</span>), mean)</span>
<span id="cb36-5"><a href="programando-con-r.html#cb36-5" aria-hidden="true" tabindex="-1"></a>d[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, ]</span>
<span id="cb36-6"><a href="programando-con-r.html#cb36-6" aria-hidden="true" tabindex="-1"></a>d[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)]</span>
<span id="cb36-7"><a href="programando-con-r.html#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(d[, <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)], mean, <span class="at">na.rm =</span> T)</span>
<span id="cb36-8"><a href="programando-con-r.html#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(d[, <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)], summary, <span class="at">na.rm =</span> T)</span></code></pre></div>
</div>
<div id="sapply" class="section level3" number="3.5.4">
<h3><span class="header-section-number">3.5.4</span> sapply()</h3>
<p>Crea resúmenes como vector o tabla</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="programando-con-r.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(d<span class="sc">$</span>Source))</span>
<span id="cb37-2"><a href="programando-con-r.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(d[, <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)], mean, <span class="at">na.rm =</span> T)</span>
<span id="cb37-3"><a href="programando-con-r.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(d[, <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)], summary, <span class="at">na.rm =</span> T)</span>
<span id="cb37-4"><a href="programando-con-r.html#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="programando-con-r.html#cb37-5" aria-hidden="true" tabindex="-1"></a>funcion_nueva <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb37-6"><a href="programando-con-r.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(d[d<span class="sc">$</span>Source <span class="sc">==</span> x, <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)], summary)</span>
<span id="cb37-7"><a href="programando-con-r.html#cb37-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-8"><a href="programando-con-r.html#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(d<span class="sc">$</span>Source))</span>
<span id="cb37-9"><a href="programando-con-r.html#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">levels</span>(<span class="fu">as.factor</span>(d<span class="sc">$</span>Source)), funcion_nueva, <span class="at">simplify =</span> F)</span></code></pre></div>
</div>
<div id="vapply" class="section level3" number="3.5.5">
<h3><span class="header-section-number">3.5.5</span> vapply()</h3>
<p>Similar al anterior, pero devuelve una salida predeterminada (puede ser más práctico)</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="programando-con-r.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(d[, <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)], mean, <span class="at">na.rm =</span> T, <span class="fu">c</span>(<span class="st">&quot;Mean&quot;</span> <span class="ot">=</span> <span class="dv">0</span>))</span>
<span id="cb38-2"><a href="programando-con-r.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(d[, <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)], fivenum, <span class="at">na.rm =</span> T, <span class="fu">c</span>(<span class="st">&quot;Min.&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">&quot;1st Qu.&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">&quot;Median&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">&quot;3rd Qu.&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">&quot;Max.&quot;</span> <span class="ot">=</span> <span class="dv">0</span>))</span></code></pre></div>
</div>
<div id="rapply" class="section level3" number="3.5.6">
<h3><span class="header-section-number">3.5.6</span> rapply()</h3>
<p>Similar al anterior, per devuelve una salida que conserva la estructura original</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="programando-con-r.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rapply</span>(d[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], summary)</span>
<span id="cb39-2"><a href="programando-con-r.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rapply</span>(d[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], summary, <span class="at">how =</span> <span class="st">&quot;list&quot;</span>)</span></code></pre></div>
<ul>
<li>Para profundizar, se recomienda seguir esta <a href="https://nsaunders.wordpress.com/2010/08/20/a-brief-introduction-to-apply-in-r/">Fuente</a></li>
</ul>
</div>
</div>
<div id="gráficos" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Gráficos</h2>
<div id="gráficos-de-dispersión" class="section level3" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> Gráficos de dispersión</h3>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="programando-con-r.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plots</span></span>
<span id="cb40-2"><a href="programando-con-r.html#cb40-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb40-3"><a href="programando-con-r.html#cb40-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">26</span>, <span class="dv">22</span>, <span class="dv">19</span>, <span class="dv">16</span>, <span class="dv">14</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">23</span>)</span>
<span id="cb40-4"><a href="programando-con-r.html#cb40-4" aria-hidden="true" tabindex="-1"></a>estaciones <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;verano&quot;</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="st">&quot;otoño&quot;</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">&quot;invierno&quot;</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">&quot;primavera&quot;</span>, <span class="dv">3</span>), <span class="st">&quot;verano&quot;</span>)</span>
<span id="cb40-5"><a href="programando-con-r.html#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="programando-con-r.html#cb40-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, y, estaciones)</span>
<span id="cb40-7"><a href="programando-con-r.html#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="programando-con-r.html#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb40-9"><a href="programando-con-r.html#cb40-9" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>x, df<span class="sc">$</span>y,</span>
<span id="cb40-10"><a href="programando-con-r.html#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;o&quot;</span>, <span class="at">pch =</span> <span class="dv">14</span>, <span class="at">xlab =</span> <span class="st">&quot;Mes&quot;</span>,</span>
<span id="cb40-11"><a href="programando-con-r.html#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Temperatura [°C]&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Lima, Temperatura mensual promedio&quot;</span></span>
<span id="cb40-12"><a href="programando-con-r.html#cb40-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
</div>
<div id="gráficos-de-líneas" class="section level3" number="3.6.2">
<h3><span class="header-section-number">3.6.2</span> Gráficos de líneas</h3>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="programando-con-r.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb41-2"><a href="programando-con-r.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>x, df<span class="sc">$</span>y,</span>
<span id="cb41-3"><a href="programando-con-r.html#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;o&quot;</span>, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">xlab =</span> <span class="st">&quot;Mes&quot;</span>,</span>
<span id="cb41-4"><a href="programando-con-r.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Temperatura [°C]&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Lima, Temperatura mensual promedio&quot;</span>, <span class="at">col =</span> <span class="st">&quot;#F47E40&quot;</span></span>
<span id="cb41-5"><a href="programando-con-r.html#cb41-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-6"><a href="programando-con-r.html#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="programando-con-r.html#cb41-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;colores&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;black&quot;</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="st">&quot;green&quot;</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">&quot;red&quot;</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">&quot;blue&quot;</span>, <span class="dv">3</span>), <span class="st">&quot;red&quot;</span>)</span>
<span id="cb41-8"><a href="programando-con-r.html#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;top&quot;</span>,</span>
<span id="cb41-9"><a href="programando-con-r.html#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="fu">levels</span>(<span class="fu">factor</span>(estaciones)),</span>
<span id="cb41-10"><a href="programando-con-r.html#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb41-11"><a href="programando-con-r.html#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>)</span>
<span id="cb41-12"><a href="programando-con-r.html#cb41-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="programando-con-r.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cars)</span>
<span id="cb42-2"><a href="programando-con-r.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb42-3"><a href="programando-con-r.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  cars<span class="sc">$</span>speed, cars<span class="sc">$</span>dist,</span>
<span id="cb42-4"><a href="programando-con-r.html#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Velocidad&quot;</span>,</span>
<span id="cb42-5"><a href="programando-con-r.html#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Distancia&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Velocidad vs distancia&quot;</span></span>
<span id="cb42-6"><a href="programando-con-r.html#cb42-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="programando-con-r.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram</span></span>
<span id="cb43-2"><a href="programando-con-r.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(cars$speed)</span></span>
<span id="cb43-3"><a href="programando-con-r.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(cars$speed, breaks = 10)</span></span>
<span id="cb43-4"><a href="programando-con-r.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(cars<span class="sc">$</span>dist, <span class="at">freq =</span> T, <span class="at">col =</span> <span class="st">&quot;skyblue&quot;</span>, <span class="at">labels =</span> T)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="programando-con-r.html#cb44-1" aria-hidden="true" tabindex="-1"></a>breaks_hist <span class="ot">&lt;-</span> <span class="fu">hist</span>(cars<span class="sc">$</span>dist, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>breaks</span>
<span id="cb44-2"><a href="programando-con-r.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(cars<span class="sc">$</span>dist, <span class="at">breaks =</span> breaks_hist, <span class="at">col =</span> <span class="st">&quot;blue1&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="programando-con-r.html#cb45-1" aria-hidden="true" tabindex="-1"></a>equakes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/earthquakes.csv&quot;</span>)</span>
<span id="cb45-2"><a href="programando-con-r.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot</span></span>
<span id="cb45-3"><a href="programando-con-r.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(cars<span class="sc">$</span>speed, cars<span class="sc">$</span>dist)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="programando-con-r.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="st">`</span><span class="at">Magnitude</span><span class="st">`</span> <span class="sc">~</span> <span class="st">`</span><span class="at">Source</span><span class="st">`</span>, equakes, <span class="at">col =</span> <span class="fu">palette</span>(<span class="fu">rainbow</span>(<span class="dv">2</span>)))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-34-2.png" width="672" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="programando-con-r.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiples plots en un grafico</span></span>
<span id="cb47-2"><a href="programando-con-r.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.new</span>()</span>
<span id="cb47-3"><a href="programando-con-r.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## png 
##   2</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="programando-con-r.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span></code></pre></div>
</div>
</div>
<div id="estilo-tidyverse" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Estilo tidyverse</h2>
<p style="text-align: justify;">
Primero necesitarás instalar algunos paquetes de R. Un paquete R es una colección de funciones, datos y documentación que amplía las capacidades de <strong>R base</strong>. El uso de paquetes es clave para el uso exitoso de R. La mayoría de los paquetes que aprenderá en este apartado son parte del llamado <strong>tidyverse</strong>. Los paquetes de tidyverse comparten una filosofía común de programación de datos y R, y están diseñados para trabajar juntos de forma natural.
</p>
<p>Puedes instalar tidyverse completo con una sola línea de código:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="programando-con-r.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p style="text-align: justify;">
En su propia computadora, escriba esa línea de código en la consola y luego presione Entrar para ejecutarlo. R descargará los paquetes de CRAN y los instalará en su computadora. Si tiene problemas con la instalación, asegúrese de estar conectado a Internet y de que <strong><a href="https://cloud.r-project.org/" class="uri">https://cloud.r-project.org/</a></strong> no esté bloqueado por su firewall o proxy.
</p>
<p style="text-align: justify;">
No podrá utilizar las funciones, los objetos y los archivos de ayuda de un paquete hasta que lo cargue con <strong><code>library()</code></strong>. Una vez que haya instalado un paquete, puede cargarlo con la función <strong><code>library()</code></strong>:
</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="programando-con-r.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
## ✓ tibble  3.1.2     ✓ dplyr   1.0.7
## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
## ✓ readr   1.4.0     ✓ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<p style="text-align: justify;">
Esto le indica que tidyverse está cargando los paquetes <strong>ggplot2, tibble, tidyr, readr, purrr y dplyr</strong>. Estos consideran los núcleo del tidyverse porque los usará en casi todos los análisis.
</p>
<p style="text-align: justify;">
Los paquetes del tidyverse cambian con bastante frecuencia. Puede ver si hay actualizaciones disponibles y, opcionalmente, instalarlas, ejecutando <strong><code>tidyverse_update()</code></strong>.
</p>
<p style="text-align: justify;">
Toma nota del mensaje de conflictos que se imprime cuando cargas el tidyverse. Te dice que dplyr sobrescribe algunas funciones en base R. Si desea usar la versión base de estas funciones después de cargar dplyr, deberá usar sus nombres completos: <strong><code>stats::filter()</code></strong> y <strong><code>stats::lag()</code></strong>
</p>
<div id="data-transformation-con-dplyr" class="section level3" number="3.7.1">
<h3><span class="header-section-number">3.7.1</span> Data Transformation con dplyr</h3>
<p style="text-align: justify;">
La visualización es una herramienta importante para la generación de información, pero es raro que obtenga los datos exactamente en la forma correcta que necesita. A menudo, necesitará crear algunas variables o resúmenes nuevos, o tal vez solo desee cambiar el nombre de las variables o reordenar las observaciones para que sea un poco más fácil trabajar con los datos. Aprenderá a hacer todo eso <strong>(¡y más!)</strong> en este apartado, que le enseñará cómo transformar sus datos utilizando el <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf"><strong>paquete dplyr</strong></a> y un nuevo conjunto de datos sobre vuelos que parten de la ciudad de Nueva York en 2013.
</p>
<p align="center">
<img width="300" src="https://ih1.redbubble.net/image.508899495.5477/st,small,507x507-pad,600x600,f8f8f8.jpg">
</p>
<p style="text-align: justify;">
En este capítulo, nos centraremos en cómo usar el paquete <strong>dplyr</strong>, otro miembro central de tidyverse. Ilustraremos las ideas clave usando datos del paquete <strong>nycflights13</strong> y usar <strong>ggplot2</strong> para ayudarnos a comprender los datos.
</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="programando-con-r.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span></code></pre></div>
<div id="nycfights13" class="section level4" number="3.7.1.1">
<h4><span class="header-section-number">3.7.1.1</span> nycfights13</h4>
<p style="text-align: justify;">
Para explorar los verbos básicos de manipulación de datos de <strong>dplyr</strong>, usaremos <strong><code>nycflights13::flights</code></strong>. Este marco de datos contiene los <strong>336,776</strong> vuelos que partieron de la ciudad de Nueva York en 2013. Los datos provienen de la <span style="color:blue">oficina Oficina de Estadísticas de Transporte de EE. UU</span>, y están documentados en <strong><code>?flights</code></strong>:
</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="programando-con-r.html#cb56-1" aria-hidden="true" tabindex="-1"></a>flights</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p style="text-align: justify;">
Es posible que observe que este <strong>dataframe</strong> se imprima un poco diferente de otros <strong>dataframe</strong> que podría haber usado en el pasado: solo muestra las primeras filas y todas las columnas que caben en una pantalla. (Para ver el conjunto de datos completo, puede ejecutar <strong><code>View(flights)</code></strong>, que abrirá el conjunto de datos en el visor de RStudio). Se imprime de manera diferente porque es un <strong>tibble</strong>. Tibbles son <strong>dataframe</strong>, pero ligeramente modificados para que funcionen mejor en <strong>tidyverse</strong>. Por ahora, no necesita preocuparse por las diferencias; volveremos a tibbles con más detalle en la Parte II del libro de <a href="https://drive.google.com/file/d/1Kd-pCPpAkaC5R5HzVqds5pau6zly3-u4/view?usp=sharing"><strong>Hadley Wickham y Garrett Grolemund (2017)</strong></a>.
</p>
<p style="text-align: justify;">
También puede haber notado la fila de abreviaturas de tres (o cuatro) letras debajo de los nombres de las columnas. <span style="color:blue">Estos describen el tipo de cada variable:</span>
</p>
<ul>
<li><strong>int</strong> significa enteros.</li>
<li><strong>dbl</strong> significa dobles o números reales.</li>
<li><strong>chr</strong> significa vectores de caracteres o cadenas.</li>
<li><strong>dttm</strong> significa fecha y hora (una fecha + una hora).</li>
</ul>
<p style="text-align: justify;">
Hay <strong>otros tres tipos comunes</strong> de variables que no se utilizan en este conjunto de datos, pero los encontrará más adelante en el libro de libro de <a href="https://drive.google.com/file/d/1Kd-pCPpAkaC5R5HzVqds5pau6zly3-u4/view?usp=sharing"><strong>Hadley Wickham y Garrett Grolemund (2017)</strong></a>:
</p>
<ul>
<li><strong>lgl</strong> significa vectores lógicos que contienen solo VERDADERO o FALSO.</li>
<li><strong>fctr</strong> significa factores, que R usa para representar categóricos variables con valores posibles fijos.</li>
<li><strong>date</strong> representa fechas.</li>
</ul>
</div>
<div id="dplyr-basics" class="section level4" number="3.7.1.2">
<h4><span class="header-section-number">3.7.1.2</span> dplyr Basics</h4>
<p>En este capítulo, aprenderá las cinco funciones clave de <strong>dplyr</strong> que le permiten resolver la gran mayoría de sus desafíos de manipulación de datos:</p>
<ul>
<li>Elija observaciones por sus valores (<strong><code>filter()</code></strong>).</li>
<li>Reordenar las filas (<strong><code>arrange()</code></strong>).</li>
<li>Elija las variables por sus nombres (<strong><code>select()</code></strong>).</li>
<li>Crear nuevas variables con funciones de variables existentes (<strong><code>mutate()</code></strong>).</li>
<li>Colapsar muchos valores en un solo resumen (<strong><code>summarize()</code></strong>)</li>
</ul>
<p style="text-align: justify;">
Todos estos se pueden usar junto con <strong><code>group_by()</code></strong>, que cambia el alcance de cada función de operar en todo el conjunto de datos a operar en él grupo por grupo. Estas seis funciones proporcionan los <strong>verbos</strong> para un lenguaje de manipulación de datos.
</p>
<p>Todos los verbos funcionan de manera similar:</p>
<ol style="list-style-type: decimal">
<li>El primer argumento es un marco de datos.</li>
<li>Los argumentos siguientes describen qué hacer con el marco de datos, utilizando los nombres de las variables <strong>(sin comillas)</strong>.</li>
<li>El resultado es un nuevo dataframe.</li>
</ol>
<p style="text-align: justify;">
Juntas, estas propiedades hacen que sea fácil encadenar varios pasos simples para lograr un resultado complejo. Profundicemos y veamos cómo funcionan estos verbos.
</p>
</div>
<div id="filtrar-filas-con-filter" class="section level4" number="3.7.1.3">
<h4><span class="header-section-number">3.7.1.3</span> Filtrar filas con filter()</h4>
<p><strong>filter()</strong> te permite filtrar un subconjunto de observaciones según sus valores. El primer argumento es el nombre del data frame. El segundo y los siguientes argumentos son las expresiones que lo filtran.</p>
<p>Por ejemplo, podemos seleccionar todos los <strong>vuelos del 1 de enero</strong> con:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="programando-con-r.html#cb58-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(flights, month <span class="sc">==</span> <span class="dv">1</span>, day <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 842 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 832 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Cuando ejecutas esa línea de código, dplyr ejecuta la operación de filtrado y devuelve un nuevo data frame. Las funciones de dplyr nunca modifican su input, por lo que si deseas guardar el resultado, necesitarás usar el operador de asignación, &lt;-:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="programando-con-r.html#cb60-1" aria-hidden="true" tabindex="-1"></a>filter01 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(flights, month <span class="sc">==</span> <span class="dv">1</span>, day <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<p>de otro modo usar el operador <strong>“%&lt;&gt;%”</strong> de la librería <strong>magrittr</strong>.</p>
<p>R imprime los resultados o los guarda en una variable. Si desea hacer ambas cosas, puede envolver la tarea <strong>entre paréntesis</strong>:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span id="cb61-1"><a href="programando-con-r.html#cb61-1" aria-hidden="true" tabindex="-1"></a>(filter02 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(flights, month <span class="sc">==</span> <span class="dv">12</span>, day <span class="sc">==</span> <span class="dv">25</span>))</span></code></pre></div>
<pre><code>## # A tibble: 719 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013    12    25      456            500        -4      649            651
##  2  2013    12    25      524            515         9      805            814
##  3  2013    12    25      542            540         2      832            850
##  4  2013    12    25      546            550        -4     1022           1027
##  5  2013    12    25      556            600        -4      730            745
##  6  2013    12    25      557            600        -3      743            752
##  7  2013    12    25      557            600        -3      818            831
##  8  2013    12    25      559            600        -1      855            856
##  9  2013    12    25      559            600        -1      849            855
## 10  2013    12    25      600            600         0      850            846
## # … with 709 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div id="comparaciones" class="section level5" number="3.7.1.3.1">
<h5><span class="header-section-number">3.7.1.3.1</span> Comparaciones</h5>
<p>Para usar el filtrado de manera efectiva, debes saber cómo seleccionar las observaciones que deseas utilizando los operadores de comparación. R proporciona el conjunto estándar: <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>!=</code> (no igual) y <code>==</code> (igual).</p>
<p>Cuando comienzas con R, el error más fácil de cometer es usar <code>=</code> en lugar de <code>==</code> cuando se busca igualdad. Cuando esto suceda, obtendrás un error informativo:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="programando-con-r.html#cb63-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(flights, <span class="at">month =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Error: Problem with `filter()` input `..1`.
## x Input `..1` is named.
## ℹ This usually means that you&#39;ve used `=` instead of `==`.
## ℹ Did you mean `month == 1`?</code></pre>
<p>Hay otro problema común que puedes encontrar al usar <code>==</code>: los números de coma flotante. <strong>¡Estos resultados pueden sorprenderte!</strong></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="programando-con-r.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">==</span> <span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="programando-con-r.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> <span class="dv">49</span> <span class="sc">*</span> <span class="dv">49</span> <span class="sc">==</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Las computadoras usan <strong>aritmética de precisión finita</strong> (obviamente, <strong>NO</strong> pueden <strong>almacenar</strong> una <strong>cantidad infinita de dígitos</strong>), así que recuerda que cada número que observas es una aproximación. En lugar de confiar en <strong><code>==</code></strong>, usa <strong><code>near()</code></strong> (cercano, en inglés):</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="programando-con-r.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">near</span>(<span class="fu">sqrt</span>(<span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="programando-con-r.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">near</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">49</span> <span class="sc">*</span> <span class="dv">49</span>, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="operadores-lógicos" class="section level5" number="3.7.1.3.2">
<h5><span class="header-section-number">3.7.1.3.2</span> Operadores lógicos</h5>
<p>Si tienes múltiples argumentos para <strong><code>filter()</code></strong> estos se combinan con <strong>“y”</strong>: cada expresión debe ser verdadera para que una fila se incluya en el output. Para otros tipos de combinaciones necesitarás usar operadores Booleanos: <strong>&amp; es “y”</strong>, <strong>| es “o”</strong>, y <strong>! es “no”</strong>. La siguiente figura
muestra el conjunto completo de operaciones <strong>Booleanas</strong>.</p>
<p align="center">
<img width="500" src="https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/transform-logical.svg">
</p>
<p>El siguiente código sirve para encontrar todos los vuelos que partieron en noviembre o diciembre:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="programando-con-r.html#cb73-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(flights, month <span class="sc">==</span> <span class="dv">11</span> <span class="sc">|</span> month <span class="sc">==</span> <span class="dv">12</span>)</span></code></pre></div>
<pre><code>## # A tibble: 55,403 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013    11     1        5           2359         6      352            345
##  2  2013    11     1       35           2250       105      123           2356
##  3  2013    11     1      455            500        -5      641            651
##  4  2013    11     1      539            545        -6      856            827
##  5  2013    11     1      542            545        -3      831            855
##  6  2013    11     1      549            600       -11      912            923
##  7  2013    11     1      550            600       -10      705            659
##  8  2013    11     1      554            600        -6      659            701
##  9  2013    11     1      554            600        -6      826            827
## 10  2013    11     1      554            600        -6      749            751
## # … with 55,393 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>El orden de las operaciones no funciona como en español. No puedes escribir <strong><code>filter(flights, month == (11 | 12))</code></strong>, que literalmente puede traducirse como <strong>“encuentra todos los vuelos que partieron en noviembre o diciembre”</strong>. En cambio, encontrará todos los meses que son iguales a <strong>11 | 12</strong>, una expresión que resulta en <strong>‘TRUE’</strong> (verdadero). En un contexto numérico (como aquí), <strong>‘TRUE’ se convierte en uno</strong>, por lo que <strong>encuentra</strong> todos los <strong>vuelos en enero</strong>, <strong>NO</strong> en <strong>noviembre o diciembre</strong>. ¡Esto es bastante confuso!</p>
<p>Una manera rápida y útil para resolver este problema es <strong><code>x %in% y</code></strong> (es decir, x en y). Esto <strong>seleccionará cada fila donde x es uno de los valores en y</strong>. Podríamos usarlo para reescribir el código de arriba:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="programando-con-r.html#cb75-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(flights, month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>))</span></code></pre></div>
<pre><code>## # A tibble: 55,403 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013    11     1        5           2359         6      352            345
##  2  2013    11     1       35           2250       105      123           2356
##  3  2013    11     1      455            500        -5      641            651
##  4  2013    11     1      539            545        -6      856            827
##  5  2013    11     1      542            545        -3      831            855
##  6  2013    11     1      549            600       -11      912            923
##  7  2013    11     1      550            600       -10      705            659
##  8  2013    11     1      554            600        -6      659            701
##  9  2013    11     1      554            600        -6      826            827
## 10  2013    11     1      554            600        -6      749            751
## # … with 55,393 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>A veces puedes simplificar subconjuntos complicados al recordar <strong>la ley de De Morgan</strong>: <strong>!(x &amp; y)</strong> es lo mismo que <strong>!x | !y</strong>, y <strong>!(x | y)</strong> es lo mismo que **!x &amp; !y*. Por ejemplo, si deseas encontrar vuelos que no se retrasaron (en llegada o partida) en más de dos horas, puedes usar cualquiera de los dos filtros siguientes:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="programando-con-r.html#cb77-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(flights, <span class="sc">!</span>(arr_delay <span class="sc">&gt;</span> <span class="dv">120</span> <span class="sc">|</span> dep_delay <span class="sc">&gt;</span> <span class="dv">120</span>))</span></code></pre></div>
<pre><code>## # A tibble: 316,050 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 316,040 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="programando-con-r.html#cb79-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(flights, arr_delay <span class="sc">&lt;=</span> <span class="dv">120</span>, dep_delay <span class="sc">&lt;=</span> <span class="dv">120</span>)</span></code></pre></div>
<pre><code>## # A tibble: 316,050 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 316,040 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Una característica importante de R que puede hacer que la <strong>comparación sea difícil son los valores faltantes</strong>, o <strong>NA’s</strong> (del inglés “no disponibles”). NA representa un valor desconocido, lo que hace que los valores perdidos sean “contagiosos”: casi cualquier operación que involucre un valor desconocido también será desconocida.</p>
<p>Si deseas determinar si falta un valor, usa <strong><code>is.na()</code></strong>:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="programando-con-r.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="programando-con-r.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(<span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><strong><code>filter()</code></strong> solo incluye filas donde la condición es <strong>TRUE</strong>; <strong>excluye</strong> tanto los valores <strong>FALSE como NA</strong>. Si deseas conservar valores perdidos, solicítalos explícitamente:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="programando-con-r.html#cb85-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">3</span>))</span>
<span id="cb85-2"><a href="programando-con-r.html#cb85-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(df, x <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       x
##   &lt;dbl&gt;
## 1     3</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="programando-con-r.html#cb87-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(df, <span class="fu">is.na</span>(x) <span class="sc">|</span> x <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 1
##       x
##   &lt;dbl&gt;
## 1    NA
## 2     3</code></pre>
<p>Siempre que empieces a usar en <code>filter()</code> expresiones complejas que tengan varias partes, considera convertirlas en variables explícitas. Eso hace que sea mucho más fácil verificar tu trabajo. Aprenderás cómo crear nuevas variables en breve.</p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">1.Encuentra todos los vuelos que:</span></p>
<p><span style="color:blue">- Tuvieron un retraso de llegada de dos o más horas</span></p>
<p><span style="color:blue">- Volaron a Houston (IAH oHOU)</span></p>
<p><span style="color:blue">- Fueron operados por United, American o Delta</span></p>
<p><span style="color:blue">- Partieron en invierno del hemisferio sur (julio, agosto y septiembre)</span></p>
<p><span style="color:blue">- Llegaron más de dos horas tarde, pero no salieron tarde</span></p>
<p><span style="color:blue">- Se retrasaron por lo menos una hora, pero repusieron más de 30 minutos en vuelo</span></p>
<p><span style="color:blue">- Partieron entre la medianoche y las 6 a.m. (incluyente)</span></p>
<p><span style="color:blue">2. Otra función de <strong><code>dplyr</code></strong> que es útil para usar filtros es <code>between()</code>. ¿Qué hace? ¿Puedes usarla para simplificar el código necesario para responder a los desafíos anteriores?</span></p>
<p><span style="color:blue">3. ¿Cuántos vuelos tienen datos faltantes en horario_salida? ¿Qué otras variables tienen valores faltantes? ¿Qué representan estas filas?</span></p>
<p><span style="color:blue">4. ¿Por qué <code>NA^0</code> no es faltante? ¿Por qué <code>NA | TRUE</code> no es faltante? ¿Por qué <code>FALSE &amp; NA</code> no es faltante? ¿Puedes descubrir la regla general? (¡<code>NA * 0</code> es un contraejemplo complicado!)</span></p>
</div>
</div>
<div id="reordenar-las-filas-con-arrange" class="section level4" number="3.7.1.4">
<h4><span class="header-section-number">3.7.1.4</span> Reordenar las filas con arrange()</h4>
<p><strong><code>arrange()** funciona de manera similar a</code>filter()` excepto que en lugar de seleccionar filas, cambia su orden. La función toma un </strong>dataframe** y un conjunto de nombres de columnas (o expresiones más complicadas) para ordenar según ellas. Si proporcionas más de un nombre de columna, cada columna adicional se utilizará para romper empates en los valores de las columnas anteriores:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="programando-con-r.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights, year, month, day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Usa <strong><code>desc()</code></strong> para reordenar por una columna en orden descendente:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="programando-con-r.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights, <span class="fu">desc</span>(arr_delay))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242           1530
##  2  2013     6    15     1432           1935      1137     1607           2120
##  3  2013     1    10     1121           1635      1126     1239           1810
##  4  2013     9    20     1139           1845      1014     1457           2210
##  5  2013     7    22      845           1600      1005     1044           1815
##  6  2013     4    10     1100           1900       960     1342           2211
##  7  2013     3    17     2321            810       911      135           1020
##  8  2013     7    22     2257            759       898      121           1026
##  9  2013    12     5      756           1700       896     1058           2020
## 10  2013     5     3     1133           2055       878     1250           2215
## # … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Los valores faltantes siempre se ordenan al final:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="programando-con-r.html#cb93-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="cn">NA</span>))</span>
<span id="cb93-2"><a href="programando-con-r.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(df, x)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 1
##       x
##   &lt;dbl&gt;
## 1     2
## 2     5
## 3    NA</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="programando-con-r.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(df, <span class="fu">desc</span>(x))</span></code></pre></div>
<pre><code>## # A tibble: 3 x 1
##       x
##   &lt;dbl&gt;
## 1     5
## 2     2
## 3    NA</code></pre>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">1. ¿Cómo podrías usar <code>arrange()</code> para ordenar todos los valores faltantes al comienzo? (Sugerencia: usa <code>is.na()</code>).</span></p>
<p><span style="color:blue">2. Ordena vuelos para encontrar los vuelos más retrasados. Encuentra los vuelos que salieron más temprano.</span></p>
<p><span style="color:blue">3. Ordena vuelos para encontrar los vuelos más rápidos (que viajaron a mayor velocidad).</span></p>
<p><span style="color:blue">4. ¿Cuáles vuelos viajaron más lejos? ¿Cuál viajó más cerca?</span></p>
</div>
<div id="seleccionar-columnas-con-select" class="section level4" number="3.7.1.5">
<h4><span class="header-section-number">3.7.1.5</span> Seleccionar columnas con select()</h4>
<p>No es raro obtener conjuntos de datos con cientos o incluso miles de variables. En este caso, el primer desafío a menudo se reduce a las variables que realmente te interesan. <code>select()</code> te permite seleccionar rápidamente un subconjunto útil utilizando operaciones basadas en los nombres de las variables.</p>
<p><code>select()</code> no es muy útil con los datos de los vuelos porque solo tenemos 19 variables, pero de todos modos se entiende la idea general:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="programando-con-r.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionar columnas por nombre</span></span>
<span id="cb97-2"><a href="programando-con-r.html#cb97-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(flights, year, month, day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # … with 336,766 more rows</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="programando-con-r.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionar todas las columnas entre anio y dia (incluyente)</span></span>
<span id="cb99-2"><a href="programando-con-r.html#cb99-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(flights, year<span class="sc">:</span>day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # … with 336,766 more rows</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="programando-con-r.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionar todas las columnas excepto aquellas entre anio en dia (incluyente)</span></span>
<span id="cb101-2"><a href="programando-con-r.html#cb101-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(flights, <span class="sc">-</span>(year<span class="sc">:</span>day))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 16
##    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  
##  1      517            515         2      830            819        11 UA     
##  2      533            529         4      850            830        20 UA     
##  3      542            540         2      923            850        33 AA     
##  4      544            545        -1     1004           1022       -18 B6     
##  5      554            600        -6      812            837       -25 DL     
##  6      554            558        -4      740            728        12 UA     
##  7      555            600        -5      913            854        19 B6     
##  8      557            600        -3      709            723       -14 EV     
##  9      557            600        -3      838            846        -8 B6     
## 10      558            600        -2      753            745         8 AA     
## # … with 336,766 more rows, and 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Hay una serie de <strong>funciones auxiliares</strong> que puedes usar dentro de <code>select()</code>:</p>
<ul>
<li><strong><code>starts_with("abc")</code></strong>: coincide con los nombres que comienzan con “abc.”</li>
<li><strong><code>ends_with("xyz")</code></strong>: coincide con los nombres que terminan con “xyz.”</li>
<li><strong><code>contains("ijk")</code></strong>: coincide con los nombres que contienen “ijk.”</li>
<li><strong><code>matches("(.)\\1")</code></strong>: selecciona variables que coinciden con una expresión regular <strong>(regex)</strong>. Esta en particular coincide con cualquier variable que contenga caracteres repetidos.</li>
<li><strong><code>num_range("x", 1:3)</code></strong>: coincide con x1,x2 y x3.</li>
</ul>
<p>Consulta <code>?select</code> para ver más detalles.</p>
<p><code>select()</code> se puede usar para cambiar el nombre de las variables, pero rara vez es útil porque descarta todas las variables que no se mencionan explícitamente. En su lugar, utiliza <strong><code>rename()</code></strong>, que es una variante de <code>select()</code> que mantiene todas las variables que no se mencionan explícitamente:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="programando-con-r.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(flights)</span></code></pre></div>
<pre><code>##  [1] &quot;year&quot;           &quot;month&quot;          &quot;day&quot;            &quot;dep_time&quot;      
##  [5] &quot;sched_dep_time&quot; &quot;dep_delay&quot;      &quot;arr_time&quot;       &quot;sched_arr_time&quot;
##  [9] &quot;arr_delay&quot;      &quot;carrier&quot;        &quot;flight&quot;         &quot;tailnum&quot;       
## [13] &quot;origin&quot;         &quot;dest&quot;           &quot;air_time&quot;       &quot;distance&quot;      
## [17] &quot;hour&quot;           &quot;minute&quot;         &quot;time_hour&quot;</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="programando-con-r.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new name = old name</span></span>
<span id="cb105-2"><a href="programando-con-r.html#cb105-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">rename</span>(flights, <span class="at">tail_num =</span> tailnum)</span>
<span id="cb105-3"><a href="programando-con-r.html#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df)</span></code></pre></div>
<pre><code>##  [1] &quot;year&quot;           &quot;month&quot;          &quot;day&quot;            &quot;dep_time&quot;      
##  [5] &quot;sched_dep_time&quot; &quot;dep_delay&quot;      &quot;arr_time&quot;       &quot;sched_arr_time&quot;
##  [9] &quot;arr_delay&quot;      &quot;carrier&quot;        &quot;flight&quot;         &quot;tail_num&quot;      
## [13] &quot;origin&quot;         &quot;dest&quot;           &quot;air_time&quot;       &quot;distance&quot;      
## [17] &quot;hour&quot;           &quot;minute&quot;         &quot;time_hour&quot;</code></pre>
<p>Otra opción es usar <code>select()</code> junto con el auxiliar <strong><code>everything()</code></strong> (todo, en inglés). Esto es útil si tienes un grupo de variables que te gustaría mover al comienzo del data frame.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="programando-con-r.html#cb107-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(flights, time_hour, air_time, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##    time_hour           air_time  year month   day dep_time sched_dep_time
##    &lt;dttm&gt;                 &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
##  1 2013-01-01 05:00:00      227  2013     1     1      517            515
##  2 2013-01-01 05:00:00      227  2013     1     1      533            529
##  3 2013-01-01 05:00:00      160  2013     1     1      542            540
##  4 2013-01-01 05:00:00      183  2013     1     1      544            545
##  5 2013-01-01 06:00:00      116  2013     1     1      554            600
##  6 2013-01-01 05:00:00      150  2013     1     1      554            558
##  7 2013-01-01 06:00:00      158  2013     1     1      555            600
##  8 2013-01-01 06:00:00       53  2013     1     1      557            600
##  9 2013-01-01 06:00:00      140  2013     1     1      557            600
## 10 2013-01-01 06:00:00      138  2013     1     1      558            600
## # … with 336,766 more rows, and 12 more variables: dep_delay &lt;dbl&gt;,
## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;</code></pre>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">1. Haz una lluvia de ideas sobre tantas maneras como sea posible para seleccionar <code>dep_time</code>, <code>dep_delay</code>, <code>arr_time</code>, and <code>arr_delay</code> de <strong>flights</strong>.</span></p>
<p><span style="color:blue">2. ¿Qué sucede si incluyes el nombre de una variable varias veces en una llamada a <code>select()</code>?</span></p>
<p><span style="color:blue">3. ¿Qué hace la función <code>any_of()</code>? ¡¿Por qué podría ser útil en conjunto con este vector?</span></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="programando-con-r.html#cb109-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;dep_delay&quot;</span>, <span class="st">&quot;arr_delay&quot;</span>)</span></code></pre></div>
<p><span style="color:blue">4. ¿Te sorprende el resultado de ejecutar el siguiente código? ¿Cómo tratan por defecto las funciones auxiliares de <code>select()</code> a las palabras en mayúsculas o en minúsculas? ¿Cómo puedes cambiar ese comportamiento predeterminado?</span></p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="programando-con-r.html#cb110-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(flights, <span class="fu">contains</span>(<span class="st">&quot;TIME&quot;</span>))</span></code></pre></div>
</div>
<div id="añadir-nuevas-variables-con-mutate" class="section level4" number="3.7.1.6">
<h4><span class="header-section-number">3.7.1.6</span> Añadir nuevas variables con mutate()</h4>
<p>Además de seleccionar conjuntos de columnas existentes, a menudo es útil crear nuevas columnas en función de columnas existentes. Ese es el trabajo de <strong><code>mutate()</code></strong> (del inglés mutar o transformar).</p>
<p><strong><code>mutate()</code></strong> siempre agrega nuevas columnas al final de un conjunto de datos, así que comenzaremos creando un conjunto de datos más pequeño para que podamos ver las nuevas variables. Recuerda que cuando usas <strong>RStudio</strong>, la manera más fácil de ver todas las columnas es <strong>View()</strong>.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="programando-con-r.html#cb111-1" aria-hidden="true" tabindex="-1"></a>flights_sml <span class="ot">&lt;-</span></span>
<span id="cb111-2"><a href="programando-con-r.html#cb111-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb111-3"><a href="programando-con-r.html#cb111-3" aria-hidden="true" tabindex="-1"></a>    flights,</span>
<span id="cb111-4"><a href="programando-con-r.html#cb111-4" aria-hidden="true" tabindex="-1"></a>    year<span class="sc">:</span>day,</span>
<span id="cb111-5"><a href="programando-con-r.html#cb111-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ends_with</span>(<span class="st">&quot;delay&quot;</span>),</span>
<span id="cb111-6"><a href="programando-con-r.html#cb111-6" aria-hidden="true" tabindex="-1"></a>    distance, air_time</span>
<span id="cb111-7"><a href="programando-con-r.html#cb111-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb111-8"><a href="programando-con-r.html#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb111-9"><a href="programando-con-r.html#cb111-9" aria-hidden="true" tabindex="-1"></a>  flights_sml,</span>
<span id="cb111-10"><a href="programando-con-r.html#cb111-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">gain =</span> arr_delay <span class="sc">-</span> dep_delay,</span>
<span id="cb111-11"><a href="programando-con-r.html#cb111-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">speed =</span> distance <span class="sc">/</span> (air_time <span class="sc">*</span> <span class="dv">60</span>)</span>
<span id="cb111-12"><a href="programando-con-r.html#cb111-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 9
##     year month   day dep_delay arr_delay distance air_time  gain  speed
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1  2013     1     1         2        11     1400      227     9 0.103 
##  2  2013     1     1         4        20     1416      227    16 0.104 
##  3  2013     1     1         2        33     1089      160    31 0.113 
##  4  2013     1     1        -1       -18     1576      183   -17 0.144 
##  5  2013     1     1        -6       -25      762      116   -19 0.109 
##  6  2013     1     1        -4        12      719      150    16 0.0799
##  7  2013     1     1        -5        19     1065      158    24 0.112 
##  8  2013     1     1        -3       -14      229       53   -11 0.0720
##  9  2013     1     1        -3        -8      944      140    -5 0.112 
## 10  2013     1     1        -2         8      733      138    10 0.0885
## # … with 336,766 more rows</code></pre>
<p>Ten en cuenta que puedes hacer referencia a las columnas que acabas de crear:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="programando-con-r.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb113-2"><a href="programando-con-r.html#cb113-2" aria-hidden="true" tabindex="-1"></a>  flights_sml,</span>
<span id="cb113-3"><a href="programando-con-r.html#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gain =</span> arr_delay <span class="sc">-</span> dep_delay,</span>
<span id="cb113-4"><a href="programando-con-r.html#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hours =</span> air_time <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="cb113-5"><a href="programando-con-r.html#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gain_per_hour =</span> gain <span class="sc">/</span> hours</span>
<span id="cb113-6"><a href="programando-con-r.html#cb113-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 10
##     year month   day dep_delay arr_delay distance air_time  gain hours
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1         2        11     1400      227     9 3.78 
##  2  2013     1     1         4        20     1416      227    16 3.78 
##  3  2013     1     1         2        33     1089      160    31 2.67 
##  4  2013     1     1        -1       -18     1576      183   -17 3.05 
##  5  2013     1     1        -6       -25      762      116   -19 1.93 
##  6  2013     1     1        -4        12      719      150    16 2.5  
##  7  2013     1     1        -5        19     1065      158    24 2.63 
##  8  2013     1     1        -3       -14      229       53   -11 0.883
##  9  2013     1     1        -3        -8      944      140    -5 2.33 
## 10  2013     1     1        -2         8      733      138    10 2.3  
## # … with 336,766 more rows, and 1 more variable: gain_per_hour &lt;dbl&gt;</code></pre>
<p>Si solo quieres conservar las nuevas variables, usa <strong><code>transmute()</code></strong>:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="programando-con-r.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">transmute</span>(</span>
<span id="cb115-2"><a href="programando-con-r.html#cb115-2" aria-hidden="true" tabindex="-1"></a>  flights,</span>
<span id="cb115-3"><a href="programando-con-r.html#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gain =</span> arr_delay <span class="sc">-</span> dep_delay,</span>
<span id="cb115-4"><a href="programando-con-r.html#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hours =</span> air_time <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="cb115-5"><a href="programando-con-r.html#cb115-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gain_per_hour =</span> gain <span class="sc">/</span> hours</span>
<span id="cb115-6"><a href="programando-con-r.html#cb115-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     gain hours gain_per_hour
##    &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
##  1     9 3.78           2.38
##  2    16 3.78           4.23
##  3    31 2.67          11.6 
##  4   -17 3.05          -5.57
##  5   -19 1.93          -9.83
##  6    16 2.5            6.4 
##  7    24 2.63           9.11
##  8   -11 0.883        -12.5 
##  9    -5 2.33          -2.14
## 10    10 2.3            4.35
## # … with 336,766 more rows</code></pre>
<div id="funciones-de-creación-útiles" class="section level5" number="3.7.1.6.1">
<h5><span class="header-section-number">3.7.1.6.1</span> Funciones de creación útiles</h5>
<p>Hay muchas funciones para crear nuevas variables que puedes usar con <code>mutate()</code>. La propiedad clave es que la función debe ser vectorizada: debe tomar un vector de valores como input, y devolver un vector con el mismo número de valores como output. No hay forma de enumerar todas las posibles funciones que podrías usar, pero aquí hay una selección de funciones que frecuentemente son útiles:</p>
<ul>
<li><p>Operadores aritméticos: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>. Todos están vectorizados usando las llamadas <strong>“reglas de reciclaje”</strong>. Si un parámetro es más corto que el otro, se extenderá automáticamente para tener la misma longitud. Esto es muy útil cuando uno de los argumentos es un solo número: <code>air_time / 60</code>, <code>hours * 60 + minute</code>, etc.
Los operadores aritméticos también son útiles junto con las funciones de agregar que aprenderás más adelante. Por ejemplo, <code>x / sum(x)</code> calcula la proporción de un total, y <code>y - mean(y)</code> calcula la diferencia de la media.</p></li>
<li><p><strong>Aritmética modular</strong>: <strong><code>%/%</code></strong> (división entera) y <strong><code>%%</code></strong> (resto), donde <code>x == y * (x %/% y) + (x %% y)</code>. La aritmética modular es una herramienta útil porque te permite dividir enteros en partes. Por ejemplo, en el conjunto de datos de vuelos, puedes calcular hora y minutos de <strong><code>dep_time</code></strong> con:</p></li>
</ul>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="programando-con-r.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">transmute</span>(</span>
<span id="cb117-2"><a href="programando-con-r.html#cb117-2" aria-hidden="true" tabindex="-1"></a>  flights,</span>
<span id="cb117-3"><a href="programando-con-r.html#cb117-3" aria-hidden="true" tabindex="-1"></a>  dep_time,</span>
<span id="cb117-4"><a href="programando-con-r.html#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hour =</span> dep_time <span class="sc">%/%</span> <span class="dv">100</span>,</span>
<span id="cb117-5"><a href="programando-con-r.html#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">minute =</span> dep_time <span class="sc">%%</span> <span class="dv">100</span></span>
<span id="cb117-6"><a href="programando-con-r.html#cb117-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##    dep_time  hour minute
##       &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1      517     5     17
##  2      533     5     33
##  3      542     5     42
##  4      544     5     44
##  5      554     5     54
##  6      554     5     54
##  7      555     5     55
##  8      557     5     57
##  9      557     5     57
## 10      558     5     58
## # … with 336,766 more rows</code></pre>
<ul>
<li><p><strong>Logaritmos:</strong> <code>log()</code>, <code>log2()</code>, <code>log10()</code>. Los logaritmos son increíblemente útiles como transformación para trabajar con datos con múltiples órdenes de magnitud. También convierten las relaciones multiplicativas en aditivas, una característica que retomaremos en los capítulos sobre modelos. En igualdad de condiciones, recomendamos usar <code>log2()</code> porque es más fácil de interpretar: una diferencia de 1 en la escala de registro corresponde a la duplicación de la escala original y una diferencia de -1 corresponde a dividir a la mitad.</p></li>
<li><p><strong>Rezagos:</strong> <code>lead()</code> y <code>lag()</code> te permiten referirte a un valor adelante o un valor atrás (con rezago). Esto te permite calcular las diferencias móviles (por ejemplo, <code>x - lag(x)</code>) o encontrar cuándo cambian los valores <code>(x! = lag (x))</code>. Estos comandos son más útiles cuando se utilizan junto con <code>group_by()</code>, algo que aprenderás en breve.</p></li>
</ul>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="programando-con-r.html#cb119-1" aria-hidden="true" tabindex="-1"></a>(x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="programando-con-r.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lag</span>(x)</span></code></pre></div>
<pre><code>##  [1] NA  1  2  3  4  5  6  7  8  9</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="programando-con-r.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lead</span>(x)</span></code></pre></div>
<pre><code>##  [1]  2  3  4  5  6  7  8  9 10 NA</code></pre>
<ul>
<li><strong>Agregados acumulativos y móviles:</strong> R proporciona funciones para ejecutar sumas, productos, mínimos y máximos: <code>cumsum()</code>, <code>cumprod()</code>, <code>cummin()</code>, <code>cummax()</code>; <strong>dplyr</strong>, por su parte, proporciona <code>cummean()</code> para las medias acumuladas. Si necesitas calcular agregados móviles (es decir, una suma calculada en una ventana móvil), prueba el paquete <strong>RcppRoll</strong>.</li>
</ul>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="programando-con-r.html#cb125-1" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="programando-con-r.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cumsum</span>(x)</span></code></pre></div>
<pre><code>##  [1]  1  3  6 10 15 21 28 36 45 55</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="programando-con-r.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cummean</span>(x)</span></code></pre></div>
<pre><code>##  [1] 1.0 1.5 2.0 2.5 3.0 3.5 4.0 4.5 5.0 5.5</code></pre>
<ul>
<li><p>Comparaciones lógicas: <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>!=</code> sobre las cuales aprendiste antes. Si estás haciendo una secuencia compleja de operaciones lógicas, es a menudo una buena idea almacenar los valores provisionales en nuevas variables para que puedas comprobar que cada paso funciona como se espera.</p></li>
<li><p>Ordenamiento: hay una serie de funciones de ordenamiento (ranking), pero deberías comenzar con <code>min_rank()</code>. Esta función realiza el tipo más común de ordenamiento (por ejemplo, primero, segundo, tercero, etc.). El valor predeterminado otorga la menor posición a los valores más pequeños; usa <code>desc(x)</code> para dar la menor posición a los valores más grandes.</p></li>
</ul>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="programando-con-r.html#cb131-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span> (<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb131-2"><a href="programando-con-r.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">min_rank</span>(y)</span></code></pre></div>
<pre><code>## [1]  1  2  2 NA  4  5</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="programando-con-r.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min_rank</span>(<span class="fu">desc</span>(y))</span></code></pre></div>
<pre><code>## [1]  5  3  3 NA  2  1</code></pre>
<ul>
<li>Si <code>min_rank()</code> no hace lo que necesitas, consulta las variantes <code>row_number()</code>, <code>dense_rank()</code>, <code>percent_rank()</code>, <code>cume_dist()</code>, <code>quantile()</code>. Revisa sus páginas de ayuda para más detalles.</li>
</ul>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="programando-con-r.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">row_number</span>(y)</span></code></pre></div>
<pre><code>## [1]  1  2  3 NA  4  5</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="programando-con-r.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dense_rank</span>(y)</span></code></pre></div>
<pre><code>## [1]  1  2  2 NA  3  4</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="programando-con-r.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">percent_rank</span>(y)</span></code></pre></div>
<pre><code>## [1] 0.00 0.25 0.25   NA 0.75 1.00</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="programando-con-r.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cume_dist</span>(y)</span></code></pre></div>
<pre><code>## [1] 0.2 0.6 0.6  NA 0.8 1.0</code></pre>
<p><strong>Ejercicios</strong></p>
<p><span style="color:blue">1. Las variables horario_salida y salida_programada tienen un formato conveniente para leer, pero es difícil realizar cualquier cálculo con ellas porque no son realmente números continuos. Transfórmalas hacia un formato más conveniente como número de minutos desde la medianoche.</p>
<p><span style="color:blue">2. Compara tiempo_vuelo con horario_llegada - horario_salida. ¿Qué esperas ver? ¿Qué ves? ¿Qué necesitas hacer para arreglarlo?</p>
<p><span style="color:blue">3. Compara horario_salida, salida_programada, y atraso_salida. ¿Cómo esperarías que esos tres números estén relacionados?</p>
<p><span style="color:blue">4. Encuentra los 10 vuelos más retrasados utilizando una función de ordenamiento. ¿Cómo quieres manejar los empates? Lee atentamente la documentación de min_rank().</p>
<p><span style="color:blue">5. ¿Qué devuelve 1:3 + 1:10? ¿Por qué?</p>
<p><span style="color:blue">6. ¿Qué funciones trigonométricas proporciona R?</p>
</div>
<div id="resúmenes-agrupados-con-summarise" class="section level5" number="3.7.1.6.2">
<h5><span class="header-section-number">3.7.1.6.2</span> Resúmenes agrupados con summarise()</h5>
<p>El último verbo clave es <strong><code>summarise()</code></strong> (resumir, en inglés). Se encarga de colapsar un data frame en una sola fila:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="programando-con-r.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(flights, <span class="at">delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   delay
##   &lt;dbl&gt;
## 1  12.6</code></pre>
<p><code>summarise()</code> no es muy útil a menos que lo enlacemos con <code>group_by()</code>. Esto cambia la unidad de análisis del conjunto de datos completo a grupos individuales. Luego, cuando uses los verbos <strong>dplyr</strong> en un data frame agrupado, estos se aplicarán automáticamente <strong>“por grupo”</strong>. Por ejemplo, si aplicamos exactamente el mismo código a un dataframe agrupado por fecha, obtenemos el retraso promedio por fecha:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="programando-con-r.html#cb145-1" aria-hidden="true" tabindex="-1"></a>by_day <span class="ot">&lt;-</span> <span class="fu">group_by</span>(flights, year, month, day)</span>
<span id="cb145-2"><a href="programando-con-r.html#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(by_day, <span class="at">delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.5 
##  2  2013     1     2 13.9 
##  3  2013     1     3 11.0 
##  4  2013     1     4  8.95
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.55
##  9  2013     1     9  2.28
## 10  2013     1    10  2.84
## # … with 355 more rows</code></pre>
<p>Juntos <code>group_by()</code> y <code>summarise()</code> proporcionan una de las herramientas que más comúnmente usarás cuando trabajes con dplyr: resúmenes agrupados. Pero antes de ir más allá con esto, tenemos que introducir una idea nueva y poderosa: el <code>pipe</code> (pronunciado /paip/, que en inglés significa ducto o tubería).</p>
<div id="combinación-de-múltiples-operaciones-con-el-pipe" class="section level6" number="3.7.1.6.2.1">
<h6><span class="header-section-number">3.7.1.6.2.1</span> Combinación de múltiples operaciones con el pipe</h6>
<p>Imagina que queremos explorar la relación entre la distancia y el atraso promedio para cada ubicación. Usando lo que sabes acerca de dplyr, podrías escribir un código como este:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="programando-con-r.html#cb148-1" aria-hidden="true" tabindex="-1"></a>by_dest <span class="ot">&lt;-</span> <span class="fu">group_by</span>(flights, dest)</span>
<span id="cb148-2"><a href="programando-con-r.html#cb148-2" aria-hidden="true" tabindex="-1"></a>delay <span class="ot">&lt;-</span></span>
<span id="cb148-3"><a href="programando-con-r.html#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb148-4"><a href="programando-con-r.html#cb148-4" aria-hidden="true" tabindex="-1"></a>    by_dest,</span>
<span id="cb148-5"><a href="programando-con-r.html#cb148-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb148-6"><a href="programando-con-r.html#cb148-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist =</span> <span class="fu">mean</span>(distance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-7"><a href="programando-con-r.html#cb148-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-8"><a href="programando-con-r.html#cb148-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-9"><a href="programando-con-r.html#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Parece que las demoras aumentan con las distancias hasta ~ 750 millas</span></span>
<span id="cb148-10"><a href="programando-con-r.html#cb148-10" aria-hidden="true" tabindex="-1"></a><span class="co"># y luego disminuyen. ¿Tal vez a medida que los vuelos se hacen más </span></span>
<span id="cb148-11"><a href="programando-con-r.html#cb148-11" aria-hidden="true" tabindex="-1"></a><span class="co"># largos, hay más habilidad para compensar las demoras en el aire?</span></span>
<span id="cb148-12"><a href="programando-con-r.html#cb148-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> delay, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> delay)) <span class="sc">+</span></span>
<span id="cb148-13"><a href="programando-con-r.html#cb148-13" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> count), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb148-14"><a href="programando-con-r.html#cb148-14" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
<p>Hay tres pasos para preparar esta información:</p>
<ol style="list-style-type: decimal">
<li>Agrupar los vuelos por destino.</li>
<li>Resumir para calcular la distancia, la demora promedio y el número de vuelos en cada grupo.</li>
<li>Filtrar para eliminar puntos ruidosos y el aeropuerto de Honolulu, que está casi dos veces más lejos que el próximo aeropuerto más cercano.</li>
</ol>
<p>Es un poco frustrante escribir este código porque tenemos que dar un nombre a cada data frame intermedio, incluso si el dataframe en sí mismo no nos importa. Nombrar cosas es difícil y <strong>dilata el tiempo</strong> de nuestro análisis.</p>
<p>Hay otra forma de abordar el mismo problema con el pipe, <strong><code>%&gt;%</code></strong>:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="programando-con-r.html#cb150-1" aria-hidden="true" tabindex="-1"></a>delays <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="programando-con-r.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span> </span>
<span id="cb150-3"><a href="programando-con-r.html#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb150-4"><a href="programando-con-r.html#cb150-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb150-5"><a href="programando-con-r.html#cb150-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist =</span> <span class="fu">mean</span>(distance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb150-6"><a href="programando-con-r.html#cb150-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb150-7"><a href="programando-con-r.html#cb150-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb150-8"><a href="programando-con-r.html#cb150-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">&gt;</span> <span class="dv">20</span>, dest <span class="sc">!=</span> <span class="st">&quot;HNL&quot;</span>)</span></code></pre></div>
<p>Este código se enfoca en las transformaciones, no en lo que se está transformando, lo que hace que sea más fácil de leer. Puedes leerlo como una serie de declaraciones imperativas: <strong>agrupa</strong>, luego <strong>resume</strong> y luego <strong>filtra</strong>. Como sugiere esta lectura, una buena forma de pronunciar <strong><code>%&gt;%</code></strong> cuando se lee el código es <strong>“luego”</strong>.</p>
<p>Lo que ocurre detrás del código, es que <strong>x %&gt;% f(y)</strong> se convierte en <strong>f(x, y)</strong>, y <strong>x %&gt;% f(y) %&gt;% g(z)</strong> se convierte en <strong>g(f(x, y), z)</strong> y así sucesivamente. Puedes usar el <strong><em>pipe</em></strong> para reescribir múltiples operaciones de forma que puedas leer de izquierda a derecha, de arriba hacia abajo. <strong>Usaremos pipes con frecuencia a partir de ahora porque mejora considerablemente la legibilidad del código</strong>. Volveremos a este tema con más detalles en pipes.</p>
<p>Trabajar con el pipe es uno de los criterios clave para pertenecer al tidyverse. La única excepción es ggplot2: se escribió antes de que se descubriera el pipe. Lamentablemente, la siguiente iteración de ggplot2, ggvis, que sí utiliza el pipe, aún no está lista para el horario estelar.</p>
</div>
<div id="valores-faltantes" class="section level6" number="3.7.1.6.2.2">
<h6><span class="header-section-number">3.7.1.6.2.2</span> Valores faltantes</h6>
<p>Es posible que te hayas preguntado sobre el argumento na.rm que utilizamos anteriormente. ¿Qué pasa si no lo configuramos?</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="programando-con-r.html#cb151-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb151-2"><a href="programando-con-r.html#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb151-3"><a href="programando-con-r.html#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(dep_delay))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1    NA
##  2  2013     1     2    NA
##  3  2013     1     3    NA
##  4  2013     1     4    NA
##  5  2013     1     5    NA
##  6  2013     1     6    NA
##  7  2013     1     7    NA
##  8  2013     1     8    NA
##  9  2013     1     9    NA
## 10  2013     1    10    NA
## # … with 355 more rows</code></pre>
<p>¡Obtenemos muchos valores faltantes! Esto se debe a que las funciones de agregación obedecen la regla habitual de valores faltantes: <strong>si hay uno en el input</strong>, <strong>el output también será un valor faltante</strong>. Afortunadamente, todas las funciones de agregación tienen un argumento <strong><code>na.rm</code></strong> que elimina los valores faltantes antes del cálculo:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="programando-con-r.html#cb154-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb154-2"><a href="programando-con-r.html#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb154-3"><a href="programando-con-r.html#cb154-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.5 
##  2  2013     1     2 13.9 
##  3  2013     1     3 11.0 
##  4  2013     1     4  8.95
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.55
##  9  2013     1     9  2.28
## 10  2013     1    10  2.84
## # … with 355 more rows</code></pre>
<p>En este caso, en el que los valores faltantes representan vuelos cancelados, también podríamos abordar el problema eliminando primero este tipo de vuelos. Guardaremos este conjunto de datos para poder reutilizarlo en los siguientes ejemplos.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="programando-con-r.html#cb157-1" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> </span>
<span id="cb157-2"><a href="programando-con-r.html#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dep_delay), <span class="sc">!</span><span class="fu">is.na</span>(arr_delay))</span>
<span id="cb157-3"><a href="programando-con-r.html#cb157-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-4"><a href="programando-con-r.html#cb157-4" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb157-5"><a href="programando-con-r.html#cb157-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb157-6"><a href="programando-con-r.html#cb157-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(dep_delay))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.4 
##  2  2013     1     2 13.7 
##  3  2013     1     3 10.9 
##  4  2013     1     4  8.97
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.56
##  9  2013     1     9  2.30
## 10  2013     1    10  2.84
## # … with 355 more rows</code></pre>
</div>
<div id="conteos" class="section level6" number="3.7.1.6.2.3">
<h6><span class="header-section-number">3.7.1.6.2.3</span> Conteos</h6>
<p>Siempre que realices una agregación, es una buena idea incluir un conteo (<strong>n()</strong>) o un recuento de valores no faltantes (<strong>sum(!is.na(x))</strong>). De esta forma, puedes verificar que no estás sacando conclusiones basadas en cantidades muy pequeñas de datos. Por ejemplo, veamos los aviones (identificados por su número de cola) que tienen las demoras promedio más altas:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="programando-con-r.html#cb160-1" aria-hidden="true" tabindex="-1"></a>delays <span class="ot">&lt;-</span> not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb160-2"><a href="programando-con-r.html#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tailnum) <span class="sc">%&gt;%</span> </span>
<span id="cb160-3"><a href="programando-con-r.html#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb160-4"><a href="programando-con-r.html#cb160-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay =</span> <span class="fu">mean</span>(arr_delay)</span>
<span id="cb160-5"><a href="programando-con-r.html#cb160-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb160-6"><a href="programando-con-r.html#cb160-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-7"><a href="programando-con-r.html#cb160-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> delays, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> delay)) <span class="sc">+</span> </span>
<span id="cb160-8"><a href="programando-con-r.html#cb160-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb160-9"><a href="programando-con-r.html#cb160-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<span style="color:blue">¡Hay algunos aviones que tienen una demora promedio de 5 horas (300 minutos)!</span>
</p>
<p>La historia es en realidad un poco más matizada. Podemos obtener más información si hacemos un diagrama de dispersión del número de vuelos contra la demora promedio:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="programando-con-r.html#cb161-1" aria-hidden="true" tabindex="-1"></a>delays <span class="ot">&lt;-</span> not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb161-2"><a href="programando-con-r.html#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tailnum) <span class="sc">%&gt;%</span> </span>
<span id="cb161-3"><a href="programando-con-r.html#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb161-4"><a href="programando-con-r.html#cb161-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb161-5"><a href="programando-con-r.html#cb161-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb161-6"><a href="programando-con-r.html#cb161-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb161-7"><a href="programando-con-r.html#cb161-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-8"><a href="programando-con-r.html#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> delays, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> delay)) <span class="sc">+</span> </span>
<span id="cb161-9"><a href="programando-con-r.html#cb161-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb161-10"><a href="programando-con-r.html#cb161-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<p>No es sorprendente que haya una mayor variación en el promedio de retraso cuando hay pocos vuelos. La forma de este gráfico es muy característica: cuando trazas un promedio (o cualquier otra medida de resumen) contra el tamaño del grupo, verás que la variación decrece a medida que el tamaño de muestra aumenta.</p>
<p>Cuando se observa este tipo de gráficos, resulta útil eliminar los grupos con menor número de observaciones, ya que puedes ver más del patrón y menos de la variación extrema de los grupos pequeños. Esto es lo que hace el siguiente bloque de código. También te ofrece una manera muy útil para integrar ggplot2 en el flujo de trabajo de dplyr. <strong>Es un poco incómodo tener que cambiar de %&gt;% a +</strong>, pero una vez que entiendas el código, verás que es bastante conveniente.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="programando-con-r.html#cb162-1" aria-hidden="true" tabindex="-1"></a>delays <span class="sc">%&gt;%</span> </span>
<span id="cb162-2"><a href="programando-con-r.html#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">25</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb162-3"><a href="programando-con-r.html#cb162-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> delay)) <span class="sc">+</span> </span>
<span id="cb162-4"><a href="programando-con-r.html#cb162-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb162-5"><a href="programando-con-r.html#cb162-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<hr />
<p>Hay otra variación común de este tipo de patrón. Veamos cómo el rendimiento promedio de los bateadores en el béisbol está relacionado con el número de veces que les toca batear. Aquí utilizaremos el conjunto de datos de bateadores para calcular el promedio de bateo (número de bateos / número de intentos) de cada jugador de béisbol de las Grandes Ligas.</p>
<p>Cuando graficamos la habilidad del bateador (medido por el promedio de bateo, pb) contra el número de oportunidades para golpear la pelota (medido por el tiempo al bate,ab), verás dos patrones:</p>
<ol style="list-style-type: decimal">
<li><p>Como en el ejemplo anterior, la variación en nuestro estadístico de resumen disminuye a medida que obtenemos más observaciones.</p></li>
<li><p>Existe una correlación positiva entre la habilidad (pb) y las oportunidades para golpear la pelota (ab). Esto se debe a que los equipos controlan quién puede jugar y, obviamente, elegirán a sus mejores jugadores.</p></li>
</ol>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="programando-con-r.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a tibble so it prints nicely</span></span>
<span id="cb163-2"><a href="programando-con-r.html#cb163-2" aria-hidden="true" tabindex="-1"></a>bateo <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(datos<span class="sc">::</span>bateadores)</span>
<span id="cb163-3"><a href="programando-con-r.html#cb163-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-4"><a href="programando-con-r.html#cb163-4" aria-hidden="true" tabindex="-1"></a>rendimiento_bateadores <span class="ot">&lt;-</span> bateo <span class="sc">%&gt;%</span> </span>
<span id="cb163-5"><a href="programando-con-r.html#cb163-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_jugador) <span class="sc">%&gt;%</span> </span>
<span id="cb163-6"><a href="programando-con-r.html#cb163-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb163-7"><a href="programando-con-r.html#cb163-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">pb =</span> <span class="fu">sum</span>(golpes, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(al_bate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb163-8"><a href="programando-con-r.html#cb163-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ab =</span> <span class="fu">sum</span>(al_bate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb163-9"><a href="programando-con-r.html#cb163-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-10"><a href="programando-con-r.html#cb163-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-11"><a href="programando-con-r.html#cb163-11" aria-hidden="true" tabindex="-1"></a>rendimiento_bateadores <span class="sc">%&gt;%</span> </span>
<span id="cb163-12"><a href="programando-con-r.html#cb163-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ab <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb163-13"><a href="programando-con-r.html#cb163-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ab, <span class="at">y =</span> pb)) <span class="sc">+</span></span>
<span id="cb163-14"><a href="programando-con-r.html#cb163-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb163-15"><a href="programando-con-r.html#cb163-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb163-16"><a href="programando-con-r.html#cb163-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<p>Esto también tiene implicaciones importantes para la clasificación. Si ingenuamente ordenas <strong><code>desc(pb)</code></strong>, verás que las personas con los mejores promedios de bateo tienen claramente mucha suerte, pero no son necesariamente hábiles:</p>
<p>Puedes encontrar una buena explicación de este problema en <a href="http://varianceexplained.org/r/empirical_bayes_baseball/">http://varianceexplained.org/r/empirical_bayes_baseball/</a> y <a href="http://www.evanmiller.org/how-not-to-sort-by-average-rating.html">http://www.evanmiller.org/how-not-to-sort-by-average-rating.html</a>.</p>
</div>
<div id="funciones-de-resumen-útiles" class="section level6" number="3.7.1.6.2.4">
<h6><span class="header-section-number">3.7.1.6.2.4</span> Funciones de resumen útiles</h6>
<p>Solo el uso de medias, conteos y sumas puede llevarte muy lejos, pero R proporciona muchas otras funciones de resumen útiles:</p>
<ul>
<li><strong>Medidas de posición:</strong> <code>first(x)</code>, <code>nth(x, 2)</code>, <code>last(x)</code>. Estas trabajan de forma similar a <code>x[1]</code>, <code>x[2]</code> y <code>x[length (x)]</code>, pero te permiten establecer un valor predeterminado en el caso de que esa posición no exista (es decir, si estás tratando de obtener el tercer elemento de un grupo que solo tiene dos elementos). Por ejemplo, podemos encontrar la primera (first) y última (last) salida para cada día:</li>
</ul>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="programando-con-r.html#cb165-1" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb165-2"><a href="programando-con-r.html#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb165-3"><a href="programando-con-r.html#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb165-4"><a href="programando-con-r.html#cb165-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">first_dep =</span> <span class="fu">first</span>(dep_time), </span>
<span id="cb165-5"><a href="programando-con-r.html#cb165-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">last_dep =</span> <span class="fu">last</span>(dep_time)</span>
<span id="cb165-6"><a href="programando-con-r.html#cb165-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 365 x 5
## # Groups:   year, month [12]
##     year month   day first_dep last_dep
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;    &lt;int&gt;
##  1  2013     1     1       517     2356
##  2  2013     1     2        42     2354
##  3  2013     1     3        32     2349
##  4  2013     1     4        25     2358
##  5  2013     1     5        14     2357
##  6  2013     1     6        16     2355
##  7  2013     1     7        49     2359
##  8  2013     1     8       454     2351
##  9  2013     1     9         2     2252
## 10  2013     1    10         3     2320
## # … with 355 more rows</code></pre>
<ul>
<li><strong>Medidas de centralidad:</strong> hemos usado <code>mean(x)</code>, pero <code>median(x)</code> también resulta muy útil. La media es la suma dividida por el número de observaciones; la mediana es un valor donde el 50% de x está por encima de él y el 50% está por debajo. A veces es útil combinar agregación con un subconjunto lógico.</li>
</ul>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="programando-con-r.html#cb167-1" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb167-2"><a href="programando-con-r.html#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb167-3"><a href="programando-con-r.html#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb167-4"><a href="programando-con-r.html#cb167-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_delay1 =</span> <span class="fu">mean</span>(arr_delay),</span>
<span id="cb167-5"><a href="programando-con-r.html#cb167-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_delay2 =</span> <span class="fu">mean</span>(arr_delay[arr_delay <span class="sc">&gt;</span> <span class="dv">0</span>]) <span class="co"># the average positive delay</span></span>
<span id="cb167-6"><a href="programando-con-r.html#cb167-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 365 x 5
## # Groups:   year, month [12]
##     year month   day avg_delay1 avg_delay2
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1  2013     1     1     12.7         32.5
##  2  2013     1     2     12.7         32.0
##  3  2013     1     3      5.73        27.7
##  4  2013     1     4     -1.93        28.3
##  5  2013     1     5     -1.53        22.6
##  6  2013     1     6      4.24        24.4
##  7  2013     1     7     -4.95        27.8
##  8  2013     1     8     -3.23        20.8
##  9  2013     1     9     -0.264       25.6
## 10  2013     1    10     -5.90        27.3
## # … with 355 more rows</code></pre>
<ul>
<li><strong>Medidas de rango:</strong> <code>min(x)</code>, <code>quantile(x, 0.25)</code>, <code>max(x)</code>. Los cuantiles son una generalización de la mediana. Por ejemplo, <code>quantile(x, 0.25)</code> encontrará un valor de x que sea mayor a 25% de los valores, y menor que el 75% restante.</li>
</ul>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="programando-con-r.html#cb169-1" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb169-2"><a href="programando-con-r.html#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb169-3"><a href="programando-con-r.html#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb169-4"><a href="programando-con-r.html#cb169-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">first =</span> <span class="fu">min</span>(dep_time),</span>
<span id="cb169-5"><a href="programando-con-r.html#cb169-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">last =</span> <span class="fu">max</span>(dep_time)</span>
<span id="cb169-6"><a href="programando-con-r.html#cb169-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 5
## # Groups:   year, month [12]
##     year month   day first  last
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1   517  2356
##  2  2013     1     2    42  2354
##  3  2013     1     3    32  2349
##  4  2013     1     4    25  2358
##  5  2013     1     5    14  2357
##  6  2013     1     6    16  2355
##  7  2013     1     7    49  2359
##  8  2013     1     8   454  2351
##  9  2013     1     9     2  2252
## 10  2013     1    10     3  2320
## # … with 355 more rows</code></pre>
<ul>
<li><strong>Medidas de dispersión:</strong> <code>sd(x)</code>, <code>IQR(x)</code>, <code>mad(x)</code>. La raíz cuadrad de la varianza o desviación estándar <code>sd(x)</code> es una medida estándar de dispersión. El rango intercuartil <code>IQR()</code> y la desviación media absoluta <code>mad(x</code>) son medidas robustas equivalentes que pueden ser más útiles si tienes <strong>valores atípicos</strong>.</li>
</ul>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="programando-con-r.html#cb172-1" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb172-2"><a href="programando-con-r.html#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span> </span>
<span id="cb172-3"><a href="programando-con-r.html#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">distance_sd =</span> <span class="fu">sd</span>(distance)) <span class="sc">%&gt;%</span> </span>
<span id="cb172-4"><a href="programando-con-r.html#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(distance_sd))</span></code></pre></div>
<pre><code>## # A tibble: 104 x 2
##    dest  distance_sd
##    &lt;chr&gt;       &lt;dbl&gt;
##  1 EGE         10.5 
##  2 SAN         10.4 
##  3 SFO         10.2 
##  4 HNL         10.0 
##  5 SEA          9.98
##  6 LAS          9.91
##  7 PDX          9.87
##  8 PHX          9.86
##  9 LAX          9.66
## 10 IND          9.46
## # … with 94 more rows</code></pre>
<p>Estas funciones son complementarias al filtrado en rangos. El filtrado te proporciona todas las variables, con cada observación en una fila distinta:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="programando-con-r.html#cb174-1" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb174-2"><a href="programando-con-r.html#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb174-3"><a href="programando-con-r.html#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r =</span> <span class="fu">min_rank</span>(<span class="fu">desc</span>(dep_time))) <span class="sc">%&gt;%</span> </span>
<span id="cb174-4"><a href="programando-con-r.html#cb174-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(r <span class="sc">%in%</span> <span class="fu">range</span>(r)) <span class="sc">%&gt;%</span></span>
<span id="cb174-5"><a href="programando-con-r.html#cb174-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(r)</span></code></pre></div>
<pre><code>## Adding missing grouping variables: `year`, `month`, `day`</code></pre>
<pre><code>## # A tibble: 770 x 4
## # Groups:   year, month, day [365]
##     year month   day     r
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1   831
##  2  2013     1     1     1
##  3  2013     1     2   928
##  4  2013     1     2     1
##  5  2013     1     3   900
##  6  2013     1     3     1
##  7  2013     1     4   908
##  8  2013     1     4     1
##  9  2013     1     4     1
## 10  2013     1     5   717
## # … with 760 more rows</code></pre>
<ul>
<li><strong>Conteos:</strong> has visto <code>n()</code>, que no toma argumentos y que devuelve el tamaño del grupo actual. Para contar la cantidad de valores no faltantes, usa <code>sum(!is.na (x))</code>. Para contar la cantidad de valores distintos (únicos), usa <code>n_distinct(x)</code>.</li>
</ul>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="programando-con-r.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Qué destinos tienen la mayoría de las aerolíneas?</span></span>
<span id="cb177-2"><a href="programando-con-r.html#cb177-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb177-3"><a href="programando-con-r.html#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span> </span>
<span id="cb177-4"><a href="programando-con-r.html#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">carriers =</span> <span class="fu">n_distinct</span>(carrier)) <span class="sc">%&gt;%</span> </span>
<span id="cb177-5"><a href="programando-con-r.html#cb177-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(carriers))</span></code></pre></div>
<pre><code>## # A tibble: 104 x 2
##    dest  carriers
##    &lt;chr&gt;    &lt;int&gt;
##  1 ATL          7
##  2 BOS          7
##  3 CLT          7
##  4 ORD          7
##  5 TPA          7
##  6 AUS          6
##  7 DCA          6
##  8 DTW          6
##  9 IAD          6
## 10 MSP          6
## # … with 94 more rows</code></pre>
<p>Los conteos son tan útiles que <strong>dplyr</strong> proporciona un ayudante simple si todo lo que quieres es un conteo:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="programando-con-r.html#cb179-1" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="programando-con-r.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(dest)</span></code></pre></div>
<pre><code>## # A tibble: 104 x 2
##    dest      n
##    &lt;chr&gt; &lt;int&gt;
##  1 ABQ     254
##  2 ACK     264
##  3 ALB     418
##  4 ANC       8
##  5 ATL   16837
##  6 AUS    2411
##  7 AVL     261
##  8 BDL     412
##  9 BGR     358
## 10 BHM     269
## # … with 94 more rows</code></pre>
<p>Opcionalmente puedes proporcionar una variable de ponderación. Por ejemplo, podrías usar esto para <strong>“contar”</strong> (sumar) el número total de millas que voló un avión:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="programando-con-r.html#cb181-1" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb181-2"><a href="programando-con-r.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(tailnum, <span class="at">wt =</span> distance)</span></code></pre></div>
<pre><code>## # A tibble: 4,037 x 2
##    tailnum      n
##    &lt;chr&gt;    &lt;dbl&gt;
##  1 D942DN    3418
##  2 N0EGMQ  239143
##  3 N10156  109664
##  4 N102UW   25722
##  5 N103US   24619
##  6 N104UW   24616
##  7 N10575  139903
##  8 N105UW   23618
##  9 N107US   21677
## 10 N108UW   32070
## # … with 4,027 more rows</code></pre>
<ul>
<li><strong>Conteos y proporciones de valores lógicos:</strong> <code>sum(x &gt; 10)</code>, <code>mean(y == 0)</code>. Cuando se usan con funciones numéricas, <code>TRUE</code> se convierte en <strong>1</strong> y <code>FALSE</code> en <strong>0</strong>. Esto hace que <code>sum()</code> y <code>mean()</code> sean muy útiles: <code>sum(x)</code> te da la cantidad de <code>TRUE</code> en <code>x</code>, y <code>mean(x)</code> te da la proporción.</li>
</ul>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="programando-con-r.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Cuántos vuelos salieron antes de las 5 am? </span></span>
<span id="cb183-2"><a href="programando-con-r.html#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (estos generalmente son vuelos demorados del día anterior)</span></span>
<span id="cb183-3"><a href="programando-con-r.html#cb183-3" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb183-4"><a href="programando-con-r.html#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb183-5"><a href="programando-con-r.html#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_early =</span> <span class="fu">sum</span>(dep_time <span class="sc">&lt;</span> <span class="dv">500</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day n_early
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1     1       0
##  2  2013     1     2       3
##  3  2013     1     3       4
##  4  2013     1     4       3
##  5  2013     1     5       3
##  6  2013     1     6       2
##  7  2013     1     7       2
##  8  2013     1     8       1
##  9  2013     1     9       3
## 10  2013     1    10       3
## # … with 355 more rows</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="programando-con-r.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Qué proporción de vuelos se retrasan más de una hora?</span></span>
<span id="cb186-2"><a href="programando-con-r.html#cb186-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> </span>
<span id="cb186-3"><a href="programando-con-r.html#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb186-4"><a href="programando-con-r.html#cb186-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">hour_prop =</span> <span class="fu">mean</span>(arr_delay <span class="sc">&gt;</span> <span class="dv">60</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day hour_prop
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;
##  1  2013     1     1    0.0722
##  2  2013     1     2    0.0851
##  3  2013     1     3    0.0567
##  4  2013     1     4    0.0396
##  5  2013     1     5    0.0349
##  6  2013     1     6    0.0470
##  7  2013     1     7    0.0333
##  8  2013     1     8    0.0213
##  9  2013     1     9    0.0202
## 10  2013     1    10    0.0183
## # … with 355 more rows</code></pre>
</div>
</div>
<div id="agrupación-por-múltiples-variables" class="section level5" number="3.7.1.6.3">
<h5><span class="header-section-number">3.7.1.6.3</span> Agrupación por múltiples variables</h5>
<p>Cuando agrupas por múltiples variables, cada resumen se desprende de un nivel de la agrupación. Eso hace que sea más fácil acumular progresivamente en un conjunto de datos:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="programando-con-r.html#cb189-1" aria-hidden="true" tabindex="-1"></a>daily <span class="ot">&lt;-</span> <span class="fu">group_by</span>(flights, year, month, day)</span>
<span id="cb189-2"><a href="programando-con-r.html#cb189-2" aria-hidden="true" tabindex="-1"></a>(per_day   <span class="ot">&lt;-</span> <span class="fu">summarise</span>(daily, <span class="at">flights =</span> <span class="fu">n</span>()))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day flights
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1     1     842
##  2  2013     1     2     943
##  3  2013     1     3     914
##  4  2013     1     4     915
##  5  2013     1     5     720
##  6  2013     1     6     832
##  7  2013     1     7     933
##  8  2013     1     8     899
##  9  2013     1     9     902
## 10  2013     1    10     932
## # … with 355 more rows</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="programando-con-r.html#cb192-1" aria-hidden="true" tabindex="-1"></a>(per_month <span class="ot">&lt;-</span> <span class="fu">summarise</span>(per_day, <span class="at">flights =</span> <span class="fu">sum</span>(flights)))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 12 x 3
## # Groups:   year [1]
##     year month flights
##    &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1   27004
##  2  2013     2   24951
##  3  2013     3   28834
##  4  2013     4   28330
##  5  2013     5   28796
##  6  2013     6   28243
##  7  2013     7   29425
##  8  2013     8   29327
##  9  2013     9   27574
## 10  2013    10   28889
## 11  2013    11   27268
## 12  2013    12   28135</code></pre>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="programando-con-r.html#cb195-1" aria-hidden="true" tabindex="-1"></a>(per_year  <span class="ot">&lt;-</span> <span class="fu">summarise</span>(per_month, <span class="at">flights =</span> <span class="fu">sum</span>(flights)))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    year flights
##   &lt;int&gt;   &lt;int&gt;
## 1  2013  336776</code></pre>
<p>Ten cuidado al acumular resúmenes progresivamente: está bien para las sumas y los recuentos, pero debes pensar en la ponderación de las medias y las varianzas, además de que no es posible hacerlo exactamente para estadísticas basadas en rangos como la mediana. En otras palabras, la suma de las sumas agrupadas es la suma total, pero la mediana de las medianas agrupadas no es la mediana general.</p>
</div>
<div id="desagrupar" class="section level5" number="3.7.1.6.4">
<h5><span class="header-section-number">3.7.1.6.4</span> Desagrupar</h5>
<p>Si necesitas eliminar la agrupación y regresar a las operaciones en datos desagrupados, usa ungroup().</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="programando-con-r.html#cb197-1" aria-hidden="true" tabindex="-1"></a>daily <span class="sc">%&gt;%</span> </span>
<span id="cb197-2"><a href="programando-con-r.html#cb197-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span>             <span class="co"># no longer grouped by date</span></span>
<span id="cb197-3"><a href="programando-con-r.html#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">flights =</span> <span class="fu">n</span>())  <span class="co"># all flights</span></span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   flights
##     &lt;int&gt;
## 1  336776</code></pre>
<p><span style="color:blue"><strong>Ejercicios</strong></p>
<p><span style="color:blue">1. Haz una lluvia de ideas de al menos 5 formas diferentes de evaluar las características de un retraso típico de un grupo de vuelos. Considera los siguientes escenarios:</p>
<p><span style="color:blue">- Un vuelo llega 15 minutos antes 50% del tiempo, y 15 minutos tarde 50% del tiempo.</p>
<p><span style="color:blue">- Un vuelo llega siempre 10 minutos tarde.</p>
<p><span style="color:blue">- Un vuelo llega 30 minutos antes 50% del tiempo, y 30 minutos tarde 50% del tiempo.</p>
<p><span style="color:blue">- Un vuelo llega a tiempo en el 99% de los casos. 1% de las veces llega 2 horas tarde.</p>
<p><span style="color:blue">¿Qué es más importante: retraso de la llegada o demora de salida?</p>
<p><span style="color:blue">2. Sugiere un nuevo enfoque que te dé el mismo output que no_cancelados %&gt;% count(destino) y no_cancelado %&gt;% count(codigo_cola, wt = distancia) (sin usar count()).</p>
<p><span style="color:blue">3. Nuestra definición de vuelos cancelados (is.na(atraso_salida) | is.na (atraso_llegada)) es un poco subóptima. ¿Por qué? ¿Cuál es la columna más importante?</p>
<p><span style="color:blue">4. Mira la cantidad de vuelos cancelados por día. ¿Hay un patrón? ¿La proporción de vuelos cancelados está relacionada con el retraso promedio?</p>
<p><span style="color:blue">5. ¿Qué compañía tiene los peores retrasos? Desafío: ¿puedes desenredar el efecto de malos aeropuertos vs. el efecto de malas aerolíneas? ¿Por qué o por qué no? (Sugerencia: piensa en vuelos %&gt;% group_by(aerolinea, destino) %&gt;% summarise(n()))</p>
<p><span style="color:blue">6. ¿Qué hace el argumento sort a count(). ¿Cuándo podrías usarlo?</span></p>
</div>
<div id="transformaciones-agrupadas-y-filtros" class="section level5" number="3.7.1.6.5">
<h5><span class="header-section-number">3.7.1.6.5</span> Transformaciones agrupadas (y filtros)</h5>
<p>La agrupación es más útil si se utiliza junto con summarise(), pero también puedes hacer operaciones convenientes con <code>mutate()</code> y <code>filter()</code>:</p>
<ul>
<li>Encuentra los peores miembros de cada grupo:</li>
</ul>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="programando-con-r.html#cb199-1" aria-hidden="true" tabindex="-1"></a>flights_sml <span class="sc">%&gt;%</span> </span>
<span id="cb199-2"><a href="programando-con-r.html#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb199-3"><a href="programando-con-r.html#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">rank</span>(<span class="fu">desc</span>(arr_delay)) <span class="sc">&lt;</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3,306 x 7
## # Groups:   year, month, day [365]
##     year month   day dep_delay arr_delay distance air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1  2013     1     1       853       851      184       41
##  2  2013     1     1       290       338     1134      213
##  3  2013     1     1       260       263      266       46
##  4  2013     1     1       157       174      213       60
##  5  2013     1     1       216       222      708      121
##  6  2013     1     1       255       250      589      115
##  7  2013     1     1       285       246     1085      146
##  8  2013     1     1       192       191      199       44
##  9  2013     1     1       379       456     1092      222
## 10  2013     1     2       224       207      550       94
## # … with 3,296 more rows</code></pre>
<p>Encuentra todos los grupos más grandes que un determinado umbral:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="programando-con-r.html#cb201-1" aria-hidden="true" tabindex="-1"></a>popular_dests <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> </span>
<span id="cb201-2"><a href="programando-con-r.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span> </span>
<span id="cb201-3"><a href="programando-con-r.html#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">365</span>)</span>
<span id="cb201-4"><a href="programando-con-r.html#cb201-4" aria-hidden="true" tabindex="-1"></a>popular_dests</span></code></pre></div>
<pre><code>## # A tibble: 332,577 x 19
## # Groups:   dest [77]
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 332,567 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>Estandariza para calcular las métricas por grupo:</li>
</ul>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="programando-con-r.html#cb203-1" aria-hidden="true" tabindex="-1"></a>popular_dests <span class="sc">%&gt;%</span> </span>
<span id="cb203-2"><a href="programando-con-r.html#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(arr_delay <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb203-3"><a href="programando-con-r.html#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_delay =</span> arr_delay <span class="sc">/</span> <span class="fu">sum</span>(arr_delay)) <span class="sc">%&gt;%</span> </span>
<span id="cb203-4"><a href="programando-con-r.html#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year<span class="sc">:</span>day, dest, arr_delay, prop_delay)</span></code></pre></div>
<pre><code>## # A tibble: 131,106 x 6
## # Groups:   dest [77]
##     year month   day dest  arr_delay prop_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1  2013     1     1 IAH          11  0.000111 
##  2  2013     1     1 IAH          20  0.000201 
##  3  2013     1     1 MIA          33  0.000235 
##  4  2013     1     1 ORD          12  0.0000424
##  5  2013     1     1 FLL          19  0.0000938
##  6  2013     1     1 ORD           8  0.0000283
##  7  2013     1     1 LAX           7  0.0000344
##  8  2013     1     1 DFW          31  0.000282 
##  9  2013     1     1 ATL          12  0.0000400
## 10  2013     1     1 DTW          16  0.000116 
## # … with 131,096 more rows</code></pre>
<p>Un filtro agrupado es una transformación agrupada seguida de un filtro desagrupado. En general, preferimos evitarlos, excepto para las manipulaciones rápidas y sucias: de lo contrario, es difícil comprobar que has hecho la manipulación correctamente.</p>
<p>Las funciones que trabajan de forma más natural en transformaciones agrupadas y filtros se conocen como funciones de ventana o window functions (frente a las funciones de resumen utilizadas para los resúmenes). Puedes obtener más información sobre las funciones de ventana útiles en la viñeta correspondiente: <code>vignette("window-functions")</code>.</p>
<p><span style="color:blue"><strong>Ejercicios</strong></p>
<p><span style="color:blue">1. Remítete a las listas de funciones útiles de mutación y filtrado. Describe cómo cambia cada operación cuando las combinas con la agrupación.</p>
<p><span style="color:blue">2. ¿Qué avión (codigo_cola) tiene el peor registro de tiempo?</p>
<p><span style="color:blue">3. ¿A qué hora del día deberías volar si quieres evitar lo más posible los retrasos?</p>
<p><span style="color:blue">4. Para cada destino, calcula los minutos totales de demora. Para cada vuelo, calcula la proporción de la demora total para su destino.</p>
<p><span style="color:blue">5. Los retrasos suelen estar temporalmente correlacionados: incluso una vez que el problema que causó el retraso inicial se ha resuelto, los vuelos posteriores se retrasan para permitir que salgan los vuelos anteriores. Usando lag(), explora cómo el retraso de un vuelo está relacionado con el retraso del vuelo inmediatamente anterior.</p>
<p><span style="color:blue">6. Mira cada destino. ¿Puedes encontrar vuelos sospechosamente rápidos? (es decir, vuelos que representan un posible error de entrada de datos). Calcula el tiempo en el aire de un vuelo relativo al vuelo más corto a ese destino. ¿Cuáles vuelos se retrasaron más en el aire?</p>
<p><span style="color:blue">7. Encuentra todos los destinos que son volados por al menos dos operadores. Usa esta información para clasificar a las aerolíneas.</p>
<p><span style="color:blue">8. Para cada avión, cuenta el número de vuelos antes del primer retraso de más de 1 hora.</span></p>
</div>
</div>
</div>
</div>
<div id="gráficos-con-ggplot" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Gráficos con ggplot</h2>
<div id="introducción" class="section level3" number="3.8.1">
<h3><span class="header-section-number">3.8.1</span> Introducción</h3>
<p><strong>“Un simple gráfico ha brindado más información a la mente del analista de datos que cualquier otro dispositivo.” — John Tukey</strong></p>
<p>En este capítulo aprenderás cómo visualizar tus datos usando el paquete ggplot2. De los muchos sistemas que posee R para hacer gráficos, ggplot2 es uno de los más elegantes y versátiles. Esto se debe a que ggplot2 implementa un sistema coherente para describir y construir gráficos, conocido como la <strong>gramática de gráficos</strong>. Con ggplot2 puedes hacer más cosas en menor tiempo, aprendiendo un único sistema y aplicándolo en diferentes ámbitos.</p>
<p>Si deseas obtener más información sobre los fundamentos teóricos de ggplot2 antes de comenzar, te recomendamos leer “La gramática de gráficos en capas,” <a href="http://vita.had.co.nz/papers/layered-grammar.pdf">http://vita.had.co.nz/papers/layered-grammar.pdf</a>.</p>
<div id="prerrequisitos" class="section level4" number="3.8.1.1">
<h4><span class="header-section-number">3.8.1.1</span> Prerrequisitos</h4>
<p>Este capítulo se centra en ggplot2, uno de los paquetes principales del Tidyverse. Para acceder a sus funciones y las páginas de ayuda que utilizaremos en este capítulo, debes cargar el Tidyverse ejecutando este código:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="programando-con-r.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>Esa única línea de código carga el núcleo del Tidyverse, que está compuesto por los paquetes que usarás en casi todos tus análisis de datos. Al correr esta línea también verás cuáles funciones de tidyverse pueden tener conflicto con funciones de R base (o de otros paquetes que puedas haber cargado previamente).</p>
<p>Si ejecutas este código y recibes el mensaje “Error in library(tidyverse): there is no package called ‘tidyverse’” (no hay ningún paquete llamado ‘tidyverse’), primero deberás instalarlo y luego ejecutar <code>library()</code>:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="programando-con-r.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb206-2"><a href="programando-con-r.html#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>Solo es necesario que instales los paquetes una única vez; sin embargo, tendrás que cargarlos siempre que inicies una nueva sesión.</p>
<p>Cuando necesitemos especificar la procedencia de una función (o un conjunto de datos), usaremos el formato especial <code>paquete::funcion()</code>. Por ejemplo, <code>ggplot2::ggplot()</code> dice explícitamente que estamos usando la función <strong>ggplot()</strong> del paquete <strong>ggplot2</strong>.</p>
<p>Además del Tidyverse, es necesario que cargues el paquete datos, ya que en él están contenidas las versiones en español de los datos que utilizaremos en este capítulo:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="programando-con-r.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;datos&quot;)</span></span>
<span id="cb207-2"><a href="programando-con-r.html#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datos)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;datos&#39;</code></pre>
<pre><code>## The following object is masked _by_ &#39;.GlobalEnv&#39;:
## 
##     frutas</code></pre>
</div>
</div>
<div id="primeros-pasos" class="section level3" number="3.8.2">
<h3><span class="header-section-number">3.8.2</span> Primeros pasos</h3>
<p>Usemos nuestro primer gráfico para responder una pregunta: ¿los automóviles con motores grandes consumen más combustible que los automóviles con motores pequeños? Probablemente ya tengas una respuesta, pero trata de responder de forma precisa. ¿Cómo es la relación entre el tamaño del motor y la eficiencia del combustible? ¿Es positiva? ¿Es negativa? ¿Es lineal o no lineal?</p>
<div id="el-data-frame-millas" class="section level4" number="3.8.2.1">
<h4><span class="header-section-number">3.8.2.1</span> El data frame millas</h4>
<p>Puedes poner a prueba tu respuesta empleando el data frame <strong>millas</strong> que se encuentra en el paquete datos <strong>(datos::millas)</strong>. Un data frame es una colección rectangular de variables (columnas) y observaciones (filas). El data frame <strong>millas</strong> contiene observaciones para 38 modelos de automóviles recopiladas por la Agencia de Protección Ambiental de los EE. UU.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="programando-con-r.html#cb210-1" aria-hidden="true" tabindex="-1"></a>millas</span></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    fabricante modelo     cilindrada  anio cilindros transmision traccion ciudad
##    &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt; &lt;int&gt;     &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;     &lt;int&gt;
##  1 audi       a4                1.8  1999         4 auto(l5)    d            18
##  2 audi       a4                1.8  1999         4 manual(m5)  d            21
##  3 audi       a4                2    2008         4 manual(m6)  d            20
##  4 audi       a4                2    2008         4 auto(av)    d            21
##  5 audi       a4                2.8  1999         6 auto(l5)    d            16
##  6 audi       a4                2.8  1999         6 manual(m5)  d            18
##  7 audi       a4                3.1  2008         6 auto(av)    d            18
##  8 audi       a4 quattro        1.8  1999         4 manual(m5)  4            18
##  9 audi       a4 quattro        1.8  1999         4 auto(l5)    4            16
## 10 audi       a4 quattro        2    2008         4 manual(m6)  4            20
## # … with 224 more rows, and 3 more variables: autopista &lt;int&gt;,
## #   combustible &lt;chr&gt;, clase &lt;chr&gt;</code></pre>
<p>Entre las variables de millas se encuentran:</p>
<ul>
<li><p><strong>cilindrada:</strong> tamaño del motor del automóvil, en litros.</p></li>
<li><p><strong>autopista:</strong> eficiencia del uso de combustible de un automóvil en carretera, en millas por galón. Al recorrer la misma distancia, un automóvil de baja eficiencia consume más combustible que un automóvil de alta eficiencia.</p></li>
</ul>
<p>Para obtener más información sobre el data frame millas, abre su página de ayuda ejecutando <code>?millas</code>.</p>
</div>
<div id="creando-un-gráfico-con-ggplot" class="section level4" number="3.8.2.2">
<h4><span class="header-section-number">3.8.2.2</span> Creando un gráfico con ggplot</h4>
<p>Para graficar <strong><code>millas</code></strong>, ejecuta este código para poner <strong><code>cilindrada</code></strong> en el eje x y <strong><code>autopista</code></strong> en el eje y:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="programando-con-r.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb212-2"><a href="programando-con-r.html#cb212-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-95-1.png" width="672" /></p>
<p>El gráfico muestra una relación negativa entre el tamaño del motor <strong>(cilindrada)</strong> y la eficiencia del combustible <strong>(autopista)</strong>. En otras palabras, <strong>los vehículos con motores grandes usan más combustible</strong>. Este resultado, ¿confirma o refuta tu hipótesis acerca de la relación entre la eficiencia del combustible y el tamaño del motor?</p>
<p><strong>Para comenzar un gráfico con ggplot2 se utiliza la función ggplot(). ggplot() crea un sistema de coordenadas al que puedes agregar capas</strong>. El <strong>primer</strong> argumento de ggplot() es el <strong>conjunto de datos</strong> que se utilizará en el gráfico. Si corres ggplot(data = millas), obtendrás un gráfico vacío. Como no es muy interesante, no vamos a mostrarlo aquí.</p>
<p>Para completar tu gráfico debes agregar una o más capas a ggplot(). La función <strong>geom_point()</strong> agrega una capa de puntos al gráfico, lo que crea un <strong>diagrama de dispersión (o scatterplot)</strong>. ggplot2 incluye muchas funciones geom, cada una de las cuales agrega un tipo de capa diferente a un gráfico. Aprenderás muchas de ellas a lo largo de este capítulo.</p>
<p>Cada función geom en ggplot2 tiene un argumento de mapping. Este define cómo se “mapean” o se asignan las variables del conjunto de datos a propiedades visuales. El argumento de mapping siempre aparece emparejado con aes() y los argumentos x e y dentro de aes() especifican qué variables asignar a estos ejes. ggplot2 busca la variable asignada en el argumento data, en este caso, millas.</p>
</div>
<div id="una-plantilla-de-gráficos" class="section level4" number="3.8.2.3">
<h4><span class="header-section-number">3.8.2.3</span> Una plantilla de gráficos</h4>
<p>Convirtamos ahora este código en una plantilla reutilizable para hacer gráficos con ggplot2. Para hacer un gráfico, reemplaza las secciones entre corchetes en el siguiente código con un conjunto de datos, una función geom o una colección de mapeos.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="programando-con-r.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="sc">&lt;</span>DATOS<span class="sc">&gt;</span>) <span class="sc">+</span></span>
<span id="cb213-2"><a href="programando-con-r.html#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>GEOM_FUNCIÓN<span class="sc">&gt;</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="sc">&lt;</span>MAPEOS<span class="sc">&gt;</span>))</span></code></pre></div>
<p>El resto de este capítulo te mostrará cómo utilizar y adaptar esta plantilla para crear diferentes tipos de gráficos. Comenzaremos por el componente <strong><code>&lt;MAPEOS&gt;</code></strong></p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- Ejecuta ggplot(data = millas). ¿Qué observas?</p>
<p><span style="color:blue">- ¿Cuántas filas hay en millas? ¿Cuántas columnas?</p>
<p><span style="color:blue">- ¿Qué describe la variable traccion? Lee la ayuda de ?millas para encontrar la respuesta.</p>
<p><span style="color:blue">- Realiza un gráfico de dispersión de autopista versus cilindros.</p>
<p><span style="color:blue">- ¿Qué sucede cuando haces un gráfico de dispersión (scatterplot) de clase versus traccion? ¿Por qué no es útil este gráfico?</p>
</div>
</div>
<div id="mapeos-estéticos" class="section level3" number="3.8.3">
<h3><span class="header-section-number">3.8.3</span> Mapeos estéticos</h3>
<p><strong>“El mayor valor de una imagen es cuando nos obliga a observar lo que no esperábamos ver.” — John Tukey</strong></p>
<p>En el siguiente gráfico, un grupo de puntos (resaltados en rojo) parece quedar fuera de la tendencia lineal. Estos automóviles tienen un kilometraje mayor de lo que esperaríamos. ¿Cómo puedes explicar estos vehículos?</p>
<p align="center">
<img width="500" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-7-1.png">
</p>
<p>Supongamos que estos automóviles son híbridos. Una forma de probar esta hipótesis es observando la variable que indica la clase de cada automóvil. La variable clase del conjunto de datos de millas clasifica los autos en grupos como compacto, mediano y SUV. Si los puntos periféricos corresponden a automóviles híbridos, deberían estar clasificados como compactos o, tal vez, subcompactos (ten en cuenta que estos datos se recopilaron antes de que las camionetas híbridas y SUV se hicieran populares).</p>
<p>Puedes agregar una tercera variable, como clase, a un diagrama de dispersión bidimensional asignándolo a un parámetro estético. Un parámetro estético (o estética) es una propiedad visual de los objetos de un gráfico. Las estéticas incluye cosas como el tamaño, la forma o el color de tus puntos. Puedes mostrar un punto (como el siguiente) de diferentes maneras si cambias los valores de sus propiedades estéticas. Como ya usamos la palabra “valor” para describir los datos, usemos la palabra “nivel” para describir las propiedades estéticas. Aquí cambiamos los niveles del tamaño, la forma y el color de un punto para que el punto sea pequeño, triangular o azul:</p>
<p align="center">
<img width="500" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-8-1.png">
</p>
<p>El mapeo entre las propiedades estéticas de tu gráfico y las variables de tu dataset te permite comunicar información sobre tus datos. Por ejemplo, puedes asignar los colores de los puntos de acuerdo a la variable clase para indicar a qué clase pertenece cada automóvil.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="programando-con-r.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb214-2"><a href="programando-con-r.html#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">color =</span> clase))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
<p>(Si prefieres el inglés británico, como Hadley, puedes usar <strong>colour</strong> en lugar de color).</p>
<p>Para mapear (o asignar) una estética a una variable, debes asociar el nombre de la estética al de la variable <strong>dentro de aes()</strong>. ggplot2 <strong>asignará automáticamente un nivel único</strong> de la estética (en este ejemplo, un color) a cada valor único de la variable. <strong>Este proceso es conocido como escalamiento (scaling)</strong>. ggplot2 acompañará el gráfico con una leyenda que explica qué niveles corresponden a qué valores.</p>
<p>Los colores revelan que muchos de los puntos inusuales son automóviles de <strong>dos asientos</strong>. ¡Estos no parecen híbridos y son, de hecho, automóviles deportivos! Los automóviles deportivos tienen motores grandes, como las camionetas todo terreno o pickups, pero su cuerpo es pequeño, como los automóviles medianos y compactos, lo que mejora su consumo de gasolina. En retrospectiva, es poco probable que estos automóviles sean híbridos, ya que tienen motores grandes.</p>
<p>En el ejemplo anterior asignamos la variable clase a la estética de color, pero podríamos haberla asignado a la estética del tamaño del mismo modo. En este caso, <strong>el tamaño exacto de cada punto revelaría a qué clase pertenece</strong>. <strong>Recibimos</strong> aquí una advertencia <strong>(warning)</strong>, porque mapear <strong>una variable no ordenada</strong> (clase) a una estética ordenada (size) <strong>no es una buena idea</strong>.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="programando-con-r.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb215-2"><a href="programando-con-r.html#cb215-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">size =</span> clase))</span></code></pre></div>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
<p>También podríamos haber asignado la variable clase a la estética <strong><code>alpha</code></strong>, que controla la <strong>transparencia</strong> de los puntos, o a la estética shape que controla la <strong>forma (shape)</strong> de los puntos.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="programando-con-r.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb217-2"><a href="programando-con-r.html#cb217-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">alpha =</span> clase))</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-99-1.png" width="672" /></p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="programando-con-r.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb219-2"><a href="programando-con-r.html#cb219-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">shape =</span> clase))</span></code></pre></div>
<pre><code>## Warning: The shape palette can deal with a maximum of 6 discrete values because
## more than 6 becomes difficult to discriminate; you have 7. Consider
## specifying shapes manually if you must have them.</code></pre>
<pre><code>## Warning: Removed 62 rows containing missing values (geom_point).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-99-2.png" width="672" /></p>
<p><strong>¿Qué pasó con los SUV? ggplot2 solo puede usar seis formas a la vez</strong>. <strong>De forma predeterminada</strong>, los grupos adicionales no se grafican cuando se emplea la estética de la forma (shape).</p>
<p>Para cada estética utilizamos aes() para asociar su nombre con la variable seleccionada para graficar. <strong>La función aes() reúne cada una de las asignaciones estéticas utilizadas por una capa y las pasa al argumento de mapeo de la capa</strong>. La sintaxis resalta una visión útil sobre x e y: las ubicaciones de x e y de un punto son en sí mismas también estéticas, es decir propiedades visuales que se puede asignar a las variables para mostrar información sobre los datos.</p>
<p>Una vez que asignas (o “mapeas”) una estética, ggplot2 se ocupa del resto. El paquete selecciona una escala razonable para usar con la estética elegida y construye una leyenda que explica la relación entre niveles y valores. Para la estética x e y, ggplot2 no crea una leyenda, pero sí una línea que delimita el eje con sus marcas de graduación y una etiqueta. La línea del eje actúa como una leyenda; explica el mapeo entre ubicaciones y valores.</p>
<p>También puedes fijar las propiedades estéticas de tu geom manualmente. Por ejemplo, podemos hacer que todos los puntos del gráfico sean azules:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="programando-con-r.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb222-2"><a href="programando-con-r.html#cb222-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-100-1.png" width="672" /></p>
<p>Aquí, el color no transmite información sobre una variable, sino que cambia la apariencia del gráfico. Para establecer una estética de forma manual, debes usar el nombre de la estética como un argumento de la función geom; es decir, va fuera de aes(). Tendrás que elegir un nivel que tenga sentido para esa estética:</p>
<ul>
<li>El nombre de un color como cadena de caracteres.</li>
<li>El tamaño de un punto en mm.</li>
<li>La forma de un punto como un número, tal como se muestra.</li>
</ul>
<p align="center">
<img width="800" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/shapes-1.png">
</p>
<p>R tiene <strong>25 formas predefinidas</strong> que están identificadas por números. Hay algunas que parecen duplicados: por ejemplo 0, 15 y 22 son todos cuadrados. La diferencia viene de la interacción entre las estéticas color y fill (relleno). <strong>Las formas vacías (0–14)</strong> tienen un borde determinado por color; <strong>las formas sólidas (15–18)</strong> están rellenas con color; <strong>las formas rellenas (21–24)</strong> tienen un borde de color y están rellenas por fill.</p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- ¿Qué no va bien en este código? ¿Por qué hay puntos que no son azules?</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="programando-con-r.html#cb223-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb223-2"><a href="programando-con-r.html#cb223-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-101-1.png" width="672" /></p>
<p><span style="color:blue">- ¿Qué variables en millas son categóricas? ¿Qué variables son continuas? (Pista: escribe ?millas para leer la documentación de ayuda para este conjunto de datos). ¿Cómo puedes ver esta información cuando ejecutas millas?</p>
<p><span style="color:blue">- Asigna una variable continua a color, size, y shape. ¿Cómo se comportan estas estéticas de manera diferente para variables categóricas y variables continuas?</p>
<p><span style="color:blue">- ¿Qué ocurre si asignas o mapeas la misma variable a múltiples estéticas?</p>
<p><span style="color:blue">- ¿Qué hace la estética stroke? ¿Con qué formas trabaja? (Pista: consulta ?geom_point)</p>
<p><span style="color:blue">- ¿Qué ocurre si se asigna o mapea una estética a algo diferente del nombre de una variable, como aes(color = cilindrada &lt; 5)?</p>
</div>
<div id="problemas-comunes" class="section level3" number="3.8.4">
<h3><span class="header-section-number">3.8.4</span> Problemas comunes</h3>
<p>A medida que empieces a escribir código en R, lo más probable es que te encuentres con problemas. No te preocupes, es lo más común. Hemos estado escribiendo código en R durante años, ¡y todos los días seguimos escribiendo código que no funciona!</p>
<p>Comienza comparando cuidadosamente el código que estás ejecutando con el código en este libro. R es extremadamente exigente y un carácter fuera de lugar puede marcar la diferencia. Asegúrate de que cada ( coincida con un ) y cada " esté emparejado con otro". Algunas veces ejecutarás el código y no pasará nada. Comprueba la parte izquierda de tu consola: si es un +, significa que R no cree que hayas escrito una expresión completa y está esperando que la termines. En este caso, normalmente es más fácil comenzar de nuevo desde cero presionando ESCAPE (la tecla esc) para cancelar el procesamiento del comando actual.</p>
<p>Un problema común al crear gráficos con ggplot2 es colocar el + en el lugar equivocado: debe ubicarse al final de la línea, no al inicio. En otras palabras, asegúrate de no haber escrito accidentalmente un código como este:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="programando-con-r.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas)</span>
<span id="cb224-2"><a href="programando-con-r.html#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span></code></pre></div>
<p>Si esto no resuelve el problema, prueba con la ayuda. Puedes obtener ayuda sobre cualquier función de R ejecutando ?nombre_de_la_funcion en la consola o seleccionando el nombre de la función y presionando F1 en RStudio. No te preocupes si la ayuda no te parece tan útil, trata entonces de saltar a los ejemplos y buscar un pedazo de código que coincida con lo que intentas hacer.</p>
<p>Si eso no ayuda, lee cuidadosamente el mensaje de error. ¡A veces la respuesta estará oculta allí! Sin embargo, cuando recién comienzas en R, puede que la respuesta esté en el mensaje de error, pero aún no sabes cómo entenderlo. Otra gran herramienta es Google: intenta buscar allí el mensaje de error, ya que es probable que otra persona haya tenido el mismo problema y haya obtenido ayuda en línea.</p>
</div>
<div id="separar-en-facetas" class="section level3" number="3.8.5">
<h3><span class="header-section-number">3.8.5</span> Separar en facetas</h3>
<p><strong>Una forma de agregar variables adicionales es con las estéticas</strong>. Otra forma particularmente útil para las variables categóricas consiste en <strong>dividir el gráfico en facetas</strong>, es decir, sub-gráficos que muestran cada uno un subconjunto de los datos.</p>
<p>Para separar en facetas un gráfico según una sola variable, utiliza facet_wrap() (del inglés envolver una faceta). El primer argumento de facet_wrap() debería ser una fórmula creada con ~ seguida del nombre de una de las variable (aquí “fórmula” es el nombre de un tipo de estructura en R, no un sinónimo de “ecuación”). La variable que uses en facet_wrap() debe ser categórica.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="programando-con-r.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb225-2"><a href="programando-con-r.html#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb225-3"><a href="programando-con-r.html#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> clase, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-103-1.png" width="672" /></p>
<p><strong>Para separar en facetas un gráfico según las combinaciones de dos variables</strong>, agrega <strong><code>facet_grid()</code></strong> a tu código del gráfico (grid quiere decir cuadrícula en inglés). El primer argumento de facet_grid() también corresponde a una fórmula. Esta vez, la fórmula debe contener dos nombres de variables separados por un ~.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="programando-con-r.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb226-2"><a href="programando-con-r.html#cb226-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb226-3"><a href="programando-con-r.html#cb226-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(traccion <span class="sc">~</span> cilindros)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
<p>Si prefieres no separar en facetas las filas o columnas, remplaza por un . el nombre de alguna de las variables, por ejemplo <strong><code>+ facet_grid(. ~ cilindros)</code></strong>.</p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- ¿Qué ocurre si intentas separar en facetas una variable continua?</p>
<p><span style="color:blue">- ¿Qué significan las celdas vacías que aparecen en el gráfico generado usando <code>facet_grid(traccion ~ cilindros)</code>? ¿Cómo se relacionan con este gráfico?</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="programando-con-r.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb227-2"><a href="programando-con-r.html#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> traccion, <span class="at">y =</span> cilindros))</span></code></pre></div>
<p><span style="color:blue">- ¿Qué grafica el siguiente código? ¿Qué hace . ?</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="programando-con-r.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb228-2"><a href="programando-con-r.html#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb228-3"><a href="programando-con-r.html#cb228-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(traccion <span class="sc">~</span> .)</span>
<span id="cb228-4"><a href="programando-con-r.html#cb228-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-5"><a href="programando-con-r.html#cb228-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb228-6"><a href="programando-con-r.html#cb228-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb228-7"><a href="programando-con-r.html#cb228-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> cilindros)</span></code></pre></div>
<p><span style="color:blue">- Mira de nuevo el primer gráfico en facetas presentado en esta sección:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="programando-con-r.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb229-2"><a href="programando-con-r.html#cb229-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb229-3"><a href="programando-con-r.html#cb229-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> clase, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><span style="color:blue">¿Cuáles son las ventajas de separar en facetas en lugar de aplicar una estética de color? ¿Cuáles son las desventajas? ¿Cómo cambiaría este balance si tuvieras un conjunto de datos más grande?</p>
<p><span style="color:blue">- Lee <code>?facet_wrap</code>. ¿Qué hace nrow? ¿Qué hace ncol? ¿Qué otras opciones controlan el diseño de los paneles individuales? ¿Por qué <code>facet_grid()</code> no tiene argumentos nrow y ncol?</p>
<p><span style="color:blue">- Cuando usas <code>facet_grid()</code>, generalmente deberías poner la variable con un mayor número de niveles únicos en las columnas. ¿Por qué?</p>
</div>
<div id="objetos-geométricos" class="section level3" number="3.8.6">
<h3><span class="header-section-number">3.8.6</span> Objetos geométricos</h3>
<p>¿En qué sentido estos dos gráficos son similares?</p>
<p align="center">
<img width="600" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-19-1.png">
<img width="600" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-19-2.png">
</p>
<p>Ambos gráficos contienen las mismas variables x e y, y ambos describen los mismos datos. <strong>Pero los gráficos no son idénticos</strong>. Cada uno utiliza un objeto visual diferente para representar los datos. En la sintaxis de ggplot2, decimos que <strong>usan diferentes geoms</strong>.</p>
<p>Un geom es el objeto geométrico usado para representar datos de forma gráfica. <strong>La gente a menudo llama a los gráficos por el tipo de geom que utiliza</strong>. Por ejemplo, los diagramas de barras usan <strong>geoms de barra (bar)</strong>, los diagramas de líneas usan <strong>geoms de línea (line)</strong>, los diagramas de caja usan <strong>geoms de diagrama de caja (boxplot)</strong>, y así sucesivamente. En inglés, los diagramas de puntos (llamados scatterplots) rompen la tendencia; ellos usan geom de punto (o point). Como vemos arriba, puedes usar diferentes geoms para graficar los mismos datos. La gráfica de arriba usa el geom de <strong>punto (geom_point())</strong>, y la gráfica de abajo usa el <strong>geom suavizado (geom_smooth())</strong>, una línea suavizada ajustada a los datos.</p>
<p>Para cambiar el geom de tu gráfico, modifica la función geom que acompaña a ggplot(). Por ejemplo, para hacer los gráficos que se muestran arriba, puedes usar este código:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="programando-con-r.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arriba</span></span>
<span id="cb230-2"><a href="programando-con-r.html#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb230-3"><a href="programando-con-r.html#cb230-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span>
<span id="cb230-4"><a href="programando-con-r.html#cb230-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-5"><a href="programando-con-r.html#cb230-5" aria-hidden="true" tabindex="-1"></a><span class="co"># abajo</span></span>
<span id="cb230-6"><a href="programando-con-r.html#cb230-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb230-7"><a href="programando-con-r.html#cb230-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span></code></pre></div>
<p><strong>Cada función geom en ggplot2 toma un argumento de mapping</strong>. Sin embargo, <strong>no todas las estéticas funcionan con todos los geom</strong>. Puedes establecer la forma para un punto, pero no puedes establecer la “forma” de una línea. Por otro lado, para una línea podrías elegir el tipo de línea (linetype). geom_smooth() dibujará una línea diferente, con un tipo de línea distinto (linetype), para cada valor único de la variable que asignes al tipo de línea (linetype).</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="programando-con-r.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb231-2"><a href="programando-con-r.html#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">linetype =</span> traccion))</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-109-1.png" width="672" /></p>
<p>Aquí <strong><code>geom_smooth()</code></strong> separa los automóviles en tres líneas en función de su valor de <strong>traccion</strong>, que describe <strong>el tipo de transmisión de un automóvil</strong>. Una línea describe todos los puntos con un valor de 4, otra línea los de valor d, y una tercera línea describe los puntos con un valor t. Aquí, 4 significa tracción en las cuatro ruedas, d tracción delantera y t tracción trasera.</p>
<p><strong>Si esto suena extraño, podemos hacerlo más claro al superponer las líneas sobre los datos brutos y luego colorear todo según traccion.</strong></p>
<p align="center">
<img width="800" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-22-1.png">
</p>
<p>¡Observa que generamos un gráfico que contiene dos geoms! Si esto te emociona, abróchate el cinturón. En la siguiente sección aprenderemos cómo colocar múltiples geoms en el mismo gráfico.</p>
<p><strong>ggplot2 proporciona más de 40 geoms</strong> y los paquetes de extensión proporcionan aún más (consulta <a href="https://exts.ggplot2.tidyverse.org/gallery/">https://exts.ggplot2.tidyverse.org/gallery/</a> para obtener una muestra). La mejor forma de obtener un panorama completo sobre las posibilidades que brinda ggplot2 es consultando la hoja de referencia (o <strong>cheatsheet</strong>), que puedes encontrar en <a href="https://rstudio.com/resources/cheatsheets/">https://rstudio.com/resources/cheatsheets/</a> (en la parte baja de la página encontrarás la versión en español). Para obtener más información sobre un tipo dado de geoms, usa la ayuda: <strong><code>?geom_smooth</code></strong>.</p>
<p>Muchos <strong>geoms</strong>, como <strong>geom_smooth()</strong>, usan un único objeto geométrico para mostrar múltiples filas de datos. Con estos geoms, <strong>puedes asignar la estética de group (grupo) a una variable categórica para graficar múltiples objetos</strong>. ggplot2 representará un objeto distinto por cada valor único de la variable de agrupamiento. En la práctica, ggplot2 agrupará automáticamente los datos para estos geoms siempre que se asigne una estética a una variable discreta (como en el ejemplo del tipo de línea o linetype). Es conveniente confiar en esta característica porque la estética del grupo en sí misma no agrega una leyenda o características distintivas a los geoms.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="programando-con-r.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb233-2"><a href="programando-con-r.html#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-110-1.png" width="672" /></p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="programando-con-r.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb235-2"><a href="programando-con-r.html#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">group =</span> traccion))</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-110-2.png" width="672" /></p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="programando-con-r.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb237-2"><a href="programando-con-r.html#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb237-3"><a href="programando-con-r.html#cb237-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">color =</span> traccion),</span>
<span id="cb237-4"><a href="programando-con-r.html#cb237-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb237-5"><a href="programando-con-r.html#cb237-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-110-3.png" width="672" /></p>
<p>Para mostrar múltiples geoms en el mismo gráfico, agrega varias funciones geom a ggplot():</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="programando-con-r.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb239-2"><a href="programando-con-r.html#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb239-3"><a href="programando-con-r.html#cb239-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-111-1.png" width="672" /></p>
<p>Esto introduce, sin embargo, cierta <strong>duplicación en nuestro código</strong>. Imagina que <strong>deseas cambiar</strong> el eje <strong>y</strong> para mostrar cilindrada en lugar de autopista. <strong>Necesitarías cambiar la variable en dos lugares y podrías olvidarte de actualizar uno</strong>. Puedes evitar este tipo de repetición <strong>pasando un conjunto de mapeos a <code>ggplot()</code></strong>. ggplot2 tratará estos mapeos como **mapeos globales* que se aplican a cada geom en el gráfico. En otras palabras, este código producirá la misma gráfica que el código anterior:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="programando-con-r.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb241-2"><a href="programando-con-r.html#cb241-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb241-3"><a href="programando-con-r.html#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-112-1.png" width="672" /></p>
<p><strong>Si colocas mapeos en una función geom, ggplot2 los tratará como mapeos locales para la capa</strong>. Estas asignaciones serán usadas para extender o sobrescribir los mapeos globales solo para esa capa. Esto permite mostrar diferentes estéticas en diferentes capas.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="programando-con-r.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb243-2"><a href="programando-con-r.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> clase)) <span class="sc">+</span></span>
<span id="cb243-3"><a href="programando-con-r.html#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-113-1.png" width="672" /></p>
<p>La misma idea se puede emplear para especificar distintos conjuntos de datos (data) para cada capa. En el siguiente caso, nuestra línea suave muestra solo un subconjunto del conjunto de datos de millas: los autos subcompactos. El argumento local de datos en <strong><code>geom_smooth()</code></strong> anula el argumento de datos globales en <code>ggplot()</code> solo para esa capa.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="programando-con-r.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb245-2"><a href="programando-con-r.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> clase)) <span class="sc">+</span></span>
<span id="cb245-3"><a href="programando-con-r.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> <span class="fu">filter</span>(millas, clase <span class="sc">==</span> <span class="st">&quot;subcompacto&quot;</span>), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-114-1.png" width="672" /></p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- ¿Qué geom usarías para generar un gráfico de líneas? ¿Y para un diagrama de caja? ¿Y para un histograma? ¿Y para un gráfico de área?</p>
<p><span style="color:blue">- Ejecuta este código en tu mente y predice cómo se verá el output. Luego, ejecuta el código en R y verifica tus predicciones.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="programando-con-r.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">color =</span> traccion)) <span class="sc">+</span></span>
<span id="cb247-2"><a href="programando-con-r.html#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb247-3"><a href="programando-con-r.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><span style="color:blue">- ¿Qué muestra show.legend = FALSE? ¿Qué pasa si lo quitas? ¿Por qué crees que lo utilizamos antes en el capítulo?</p>
<p><span style="color:blue">- ¿Qué hace el argumento se en geom_smooth()?</p>
<p><span style="color:blue">- ¿Se verán distintos estos gráficos? ¿Por qué sí o por qué no?</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="programando-con-r.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb248-2"><a href="programando-con-r.html#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb248-3"><a href="programando-con-r.html#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb248-4"><a href="programando-con-r.html#cb248-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-5"><a href="programando-con-r.html#cb248-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb248-6"><a href="programando-con-r.html#cb248-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb248-7"><a href="programando-con-r.html#cb248-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span></code></pre></div>
<p><span style="color:blue">- Recrea el código R necesario para generar los siguientes gráficos:</p>
<p align="center">
<img width="600" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-1.png">
<img width="600" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-2.png">
<img width="600" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-3.png">
<img width="600" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-4.png">
<img width="600" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-5.png">
<img width="600" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-6.png">
</p>
</div>
<div id="transformaciones-estadísticas" class="section level3" number="3.8.7">
<h3><span class="header-section-number">3.8.7</span> Transformaciones estadísticas</h3>
<p>A continuación, echemos un vistazo a un <strong>gráfico de barras</strong>. Los gráficos de barras parecen simples, pero son interesantes porque revelan algo sutil sobre los gráficos. Considera un gráfico de barras básico, como uno realizado con <strong><code>geom_bar()</code></strong>. El siguiente gráfico muestra la cantidad total de diamantes en el <strong>conjunto de datos diamantes</strong>, agrupados por la <strong>variable corte</strong>. El conjunto de datos diamantes se encuentra en el paquete datos y contiene información sobre ~ 54000 diamantes, <strong>incluido el precio, el quilate, el color, la claridad y el corte de cada uno</strong>. El gráfico muestra que hay más diamantes disponibles con cortes de alta calidad que con cortes de baja calidad.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="programando-con-r.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb249-2"><a href="programando-con-r.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-117-1.png" width="672" /></p>
<p>En el eje x, el gráfico muestra <strong>corte</strong>, una variable de diamantes. En el eje y muestra el <strong>recuento (count)</strong>, ¡pero el recuento no es una variable en diamantes! <strong>¿De dónde viene?</strong> Muchos gráficos, como los diagramas de dispersión (scatterplots), grafican los valores brutos de un conjunto de datos. Otros gráficos, como los de barras, calculan nuevos valores para presentar:</p>
<ul>
<li><p>Los gráficos de barras, los histogramas y los polígonos de frecuencia almacenan los datos y luego grafican los conteos por contenedores (bins), es decir, el número de puntos que caen en cada contenedor.</p></li>
<li><p>Los gráficos de líneas suavizadas (smoothers) ajustan un modelo a los datos y luego grafican las predicciones del modelo.</p></li>
<li><p>Los diagramas de caja (boxplots) calculan un resumen robusto de la distribución y luego muestran una caja con formato especial.</p></li>
</ul>
<p>El algoritmo utilizado para calcular nuevos valores para un gráfico se llama <strong>stat</strong>, abreviatura en inglés de transformación estadística (statistical transformation). La siguiente figura describe cómo funciona este proceso con geom_bar().</p>
<p align="center">
<img width="900" src="https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/visualization-stat-bar.svg">
</p>
<p>Puedes aprender acerca de qué <strong>stat usa cada geom</strong> inspeccionando el valor predeterminado para el argumento stat. Por ejemplo, <code>?geom_bar</code> muestra que el <strong>valor predeterminado para stat es “count”</strong>, lo que significa que <code>geom_bar()</code> <strong>usa <code>stat_count()</code></strong>. <code>stat_count()</code> está documentado en la misma página que geom_bar() y si te desplazas hacia abajo puedes encontrar una sección llamada “Computed variables” (Variables calculadas). Ahí se describe cómo calcula dos <strong>nuevas variables: count y prop</strong>.</p>
<p>Por lo general, puedes usar geoms y estadísticas de forma intercambiable. Por ejemplo, puedes volver a crear la gráfica anterior usando <strong><code>stat_count()</code></strong> en lugar de <strong><code>geom_bar()</code></strong>:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="programando-con-r.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb250-2"><a href="programando-con-r.html#cb250-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_count</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-118-1.png" width="672" /></p>
<p>Esto funciona porque <strong>cada geom tiene una estadística predeterminada y cada estadística tiene un geom predeterminado</strong>. Esto significa que generalmente <strong>puedes usar geoms sin preocuparte por la transformación estadística subyacente</strong>.</p>
<p>Hay tres razones por las que podrías necesitar usar una estadística explícitamente:</p>
<ol style="list-style-type: decimal">
<li><strong>Es posible que desees anular la estadística predeterminada</strong>. En el siguiente código, cambiamos en geom_bar() la estadística recuento (“count,” el valor predeterminado) a identidad <strong>(“identity”)</strong>. Esto nos permite asignar la altura de las barras a los valores brutos de una variable <strong>y</strong>. Desafortunadamente, cuando las personas hablan de gráficos de barras de manera informal, podrían estar refiriéndose a este tipo de gráfico de barras, en el que la altura de la barra ya está presente en los datos, o bien, al gráfico de barras anterior, en el que la altura de la barra se determina contando filas.</li>
</ol>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="programando-con-r.html#cb251-1" aria-hidden="true" tabindex="-1"></a>demo <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb251-2"><a href="programando-con-r.html#cb251-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>corte,     <span class="sc">~</span>freq,</span>
<span id="cb251-3"><a href="programando-con-r.html#cb251-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Regular&quot;</span>,   <span class="dv">1610</span>,</span>
<span id="cb251-4"><a href="programando-con-r.html#cb251-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Bueno&quot;</span>,     <span class="dv">4906</span>,</span>
<span id="cb251-5"><a href="programando-con-r.html#cb251-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Muy Bueno&quot;</span>, <span class="dv">12082</span>,</span>
<span id="cb251-6"><a href="programando-con-r.html#cb251-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Premium&quot;</span>,   <span class="dv">13791</span>,</span>
<span id="cb251-7"><a href="programando-con-r.html#cb251-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Ideal&quot;</span>,     <span class="dv">21551</span></span>
<span id="cb251-8"><a href="programando-con-r.html#cb251-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb251-9"><a href="programando-con-r.html#cb251-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-10"><a href="programando-con-r.html#cb251-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> demo) <span class="sc">+</span></span>
<span id="cb251-11"><a href="programando-con-r.html#cb251-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">y =</span> freq), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-119-1.png" width="672" /></p>
<p>(No te preocupes si nunca has visto <strong>&lt;-</strong> o <strong>tribble()</strong>. Puede que seas capaz de adivinar su significado por el contexto y ¡pronto aprenderás qué es lo que hacen exactamente!)</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Es posible que desees anular el mapeo predeterminado</strong> de las variables transformadas a las estéticas. Por ejemplo, es posible que desees mostrar un gráfico de <strong>barras de proporciones</strong>, en lugar de un recuento:</li>
</ol>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="programando-con-r.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb252-2"><a href="programando-con-r.html#cb252-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">y =</span> <span class="fu">stat</span>(prop), <span class="at">group =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-120-1.png" width="672" /></p>
<p>Para encontrar las variables calculadas por <strong>stat</strong>, busca la sección de ayuda titulada <strong>“Compute Variables”</strong>.</p>
<ol start="3" style="list-style-type: decimal">
<li>Es posible que desees resaltar la transformación estadística en tu código. Por ejemplo, puedes usar <strong>stat_summary()</strong>, que resume los valores de <strong>y</strong> para cada valor único de x, para así resaltar el resumen que se está computando:</li>
</ol>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="programando-con-r.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb253-2"><a href="programando-con-r.html#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb253-3"><a href="programando-con-r.html#cb253-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">y =</span> profundidad),</span>
<span id="cb253-4"><a href="programando-con-r.html#cb253-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.min =</span> min,</span>
<span id="cb253-5"><a href="programando-con-r.html#cb253-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.max =</span> max,</span>
<span id="cb253-6"><a href="programando-con-r.html#cb253-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> median</span>
<span id="cb253-7"><a href="programando-con-r.html#cb253-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-121-1.png" width="672" /></p>
<p><strong>ggplot2 proporciona más de 20 transformaciones estadísticas para que uses</strong>. Cada <strong>stat</strong> es una función, por lo que puedes obtener ayuda de la manera habitual, por ejemplo: <code>?stat_bin</code>. Para ver una lista completa de transformaciones estadísticas disponibles para ggplot2, consulta la hoja de referencia.</p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- ¿Cuál es el geom predeterminado asociado con stat_summary()? ¿Cómo podrías reescribir el gráfico anterior para usar esa función geom en lugar de la función stat?</p>
<p><span style="color:blue">- ¿Qué hace geom_col()? ¿En qué se diferencia de geom_bar()?</p>
<p><span style="color:blue">- La mayoría de los geoms y las transformaciones estadísticas vienen en pares que casi siempre se usan en conjunto. Lee la documentación y haz una lista de todos los pares. ¿Qué tienen en común?</p>
<p><span style="color:blue">- ¿Qué variables calcula stat_smooth()? ¿Qué parámetros controlan su comportamiento?</p>
<p><span style="color:blue">- En nuestro gráfico de barras de proporción necesitamos establecer group = 1. ¿Por qué? En otras palabras, ¿cuál es el problema con estos dos gráficos?</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="programando-con-r.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb254-2"><a href="programando-con-r.html#cb254-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">y =</span> <span class="fu">after_stat</span>(prop))</span>
<span id="cb254-3"><a href="programando-con-r.html#cb254-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-4"><a href="programando-con-r.html#cb254-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb254-5"><a href="programando-con-r.html#cb254-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> color, <span class="at">y =</span> <span class="fu">after_stat</span>(prop))</span></code></pre></div>
</div>
<div id="ajustes-de-posición" class="section level3" number="3.8.8">
<h3><span class="header-section-number">3.8.8</span> Ajustes de posición</h3>
<p><strong>Hay una pieza más de magia asociada</strong> con los gráficos de barras. Puedes colorear un gráfico de barras usando tanto la estética de color como la <strong>más útil fill</strong> (relleno):</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="programando-con-r.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb255-2"><a href="programando-con-r.html#cb255-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">colour =</span> corte))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-123-1.png" width="672" /></p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="programando-con-r.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb256-2"><a href="programando-con-r.html#cb256-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> corte))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-123-2.png" width="672" /></p>
<p>Mira lo que sucede si <strong>asignas la estética de relleno (fill) a otra variable</strong>, como claridad: <strong>las barras se apilan automáticamente.</strong> Cada rectángulo de color representa una <strong>combinación de corte y claridad.</strong></p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="programando-con-r.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb257-2"><a href="programando-con-r.html#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> claridad))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-124-1.png" width="672" /></p>
<p>El apilamiento se realiza automáticamente mediante el ajuste de posición especificado por el argumento position. <strong>Si no deseas un gráfico de barras apiladas (“stack”)</strong>, puedes usar una de las otras tres opciones: <strong>“identity,” “dodge” o “fill”</strong>.</p>
<ul>
<li><strong>position = “identity” colocará cada objeto exactamente donde cae en el contexto del gráfico</strong>. Esto no es muy útil al momento de graficar barras, ya que las superpone. Para ver esa superposición, debemos hacer que las barras sean ligeramente transparentes configurando el alpha a un valor pequeño, o completamente transparente al establecer fill = NA.</li>
</ul>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="programando-con-r.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> claridad)) <span class="sc">+</span></span>
<span id="cb258-2"><a href="programando-con-r.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-125-1.png" width="672" /></p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="programando-con-r.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">colour =</span> claridad)) <span class="sc">+</span></span>
<span id="cb259-2"><a href="programando-con-r.html#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-125-2.png" width="672" /></p>
<p>El ajuste de <strong>position = identity</strong> es más útil para geoms 2D, como puntos, donde es la opción predeterminada.</p>
<ul>
<li><strong>position = “fill”</strong> funciona como el apilamiento de <strong>position = “stack”</strong>, pero hace que cada conjunto de barras apiladas tenga la misma altura. Esto hace que sea más fácil comparar proporciones entre grupos.</li>
</ul>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="programando-con-r.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb260-2"><a href="programando-con-r.html#cb260-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> claridad), <span class="at">position =</span> <span class="st">&quot;fill&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-126-1.png" width="672" /></p>
<ul>
<li><strong>position = “dodge”</strong> coloca los objetos superpuestos uno al lado del otro. Esto hace que sea más fácil comparar valores individuales.</li>
</ul>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="programando-con-r.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb261-2"><a href="programando-con-r.html#cb261-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> claridad), <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-127-1.png" width="672" /></p>
<p>Hay otro tipo de ajuste que no es útil para gráficos de barras, pero que puede ser muy útil para diagramas de dispersión. Recuerda nuestro primer diagrama de dispersión. <strong>¿Notaste que mostraba solo 126 puntos, a pesar de que hay 234 observaciones en el conjunto de datos?</strong></p>
<p align="center">
<img width="600" src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-43-1.png">
</p>
<p>Los valores de las variables <strong>autopista y cilindrada</strong> se redondean de modo que los puntos aparecen en una cuadrícula y <strong>muchos se superponen entre sí</strong>. Este problema se conoce como solapamiento <strong>(overplotting)</strong>. Esta disposición hace que sea difícil ver dónde está la masa de datos. ¿Los puntos de datos se distribuyen equitativamente a lo largo de la gráfica, o hay una combinación especial de autopista y cilindrada que contiene 109 valores?</p>
<p><strong>Puedes evitar esto</strong> estableciendo el ajuste de posición en “jitter.” <strong>position = “jitter”</strong> agrega una pequeña cantidad de ruido aleatorio a cada punto. <strong>Esto dispersa los puntos</strong>, ya que es poco probable que dos puntos reciban la misma cantidad de ruido aleatorio.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="programando-con-r.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb262-2"><a href="programando-con-r.html#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista), <span class="at">position =</span> <span class="st">&quot;jitter&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-128-1.png" width="672" /></p>
<p><strong>Agregar aleatoriedad a los puntos puede parecer una forma extraña de mejorar tu gráfico</strong>. Si bien hace que sea menos preciso a escalas pequeñas, lo hace ser más revelador a gran escala. Como esta es una operación tan útil, ggplot2 incluye una abreviatura de geom_point(position = “jitter”): geom_jitter().</p>
<p>Para obtener más información sobre ajustes de posición, busca la página de ayuda asociada con cada ajuste: ?position_dodge, ?position_fill, ?position_identity, ?position_jitter y ?position_stack.</p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- ¿Cuál es el problema con este gráfico? ¿Cómo podrías mejorarlo?</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="programando-con-r.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ciudad, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb263-2"><a href="programando-con-r.html#cb263-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-129-1.png" width="672" /></p>
<p><span style="color:blue">- ¿Qué parámetros de geom_jitter() controlan la cantidad de ruido?</p>
<p><span style="color:blue">- Compara y contrasta geom_jitter() con geom_count()</p>
<p><span style="color:blue">- ¿Cuál es el ajuste de posición predeterminado de geom_boxplot()? Crea una visualización del conjunto de datos de millas que lo demuestre.</p>
</div>
<div id="sistemas-de-coordenadas" class="section level3" number="3.8.9">
<h3><span class="header-section-number">3.8.9</span> Sistemas de coordenadas</h3>
<p>Los sistemas de coordenadas son probablemente la parte más complicada de ggplot2. El sistema predeterminado es el sistema de coordenadas cartesianas, donde las posiciones x e y actúan independientemente para determinar la ubicación de cada punto. Hay varios otros sistemas de coordenadas que ocasionalmente son útiles.</p>
<ul>
<li><strong>coord_flip() cambia los ejes x e y</strong>. Esto es útil, por ejemplo, si quieres <strong>diagramas de caja horizontales</strong>. También es útil para etiquetas largas: es difícil ajustarlas sin que se superpongan en el eje x.</li>
</ul>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="programando-con-r.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> clase, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb264-2"><a href="programando-con-r.html#cb264-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-130-1.png" width="672" /></p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="programando-con-r.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> clase, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb265-2"><a href="programando-con-r.html#cb265-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb265-3"><a href="programando-con-r.html#cb265-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-130-2.png" width="672" /></p>
<ul>
<li><strong>coord_quickmap() establece correctamente la relación de aspecto para los mapas</strong>. Esto es muy importante si graficas datos espaciales con ggplot2 (tema para el que, desafortunadamente, no contamos con espacio para desarrollar en este libro).</li>
</ul>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="programando-con-r.html#cb266-1" aria-hidden="true" tabindex="-1"></a>nz <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;nz&quot;</span>)</span>
<span id="cb266-2"><a href="programando-con-r.html#cb266-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-3"><a href="programando-con-r.html#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nz, <span class="fu">aes</span>(long, lat, <span class="at">group =</span> group)) <span class="sc">+</span></span>
<span id="cb266-4"><a href="programando-con-r.html#cb266-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-131-1.png" width="672" /></p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="programando-con-r.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nz, <span class="fu">aes</span>(long, lat, <span class="at">group =</span> group)) <span class="sc">+</span></span>
<span id="cb267-2"><a href="programando-con-r.html#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb267-3"><a href="programando-con-r.html#cb267-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-131-2.png" width="672" /></p>
<ul>
<li><strong>coord_polar() usa coordenadas polares</strong>. Las coordenadas polares revelan una conexión interesante entre un gráfico de barras y un gráfico de Coxcomb.</li>
</ul>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="programando-con-r.html#cb268-1" aria-hidden="true" tabindex="-1"></a>bar <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb268-2"><a href="programando-con-r.html#cb268-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb268-3"><a href="programando-con-r.html#cb268-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> corte),</span>
<span id="cb268-4"><a href="programando-con-r.html#cb268-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb268-5"><a href="programando-con-r.html#cb268-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1</span></span>
<span id="cb268-6"><a href="programando-con-r.html#cb268-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb268-7"><a href="programando-con-r.html#cb268-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb268-8"><a href="programando-con-r.html#cb268-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb268-9"><a href="programando-con-r.html#cb268-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-10"><a href="programando-con-r.html#cb268-10" aria-hidden="true" tabindex="-1"></a>bar <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-132-1.png" width="672" /></p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="programando-con-r.html#cb269-1" aria-hidden="true" tabindex="-1"></a>bar <span class="sc">+</span> <span class="fu">coord_polar</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-132-2.png" width="672" /></p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- Convierte un gráfico de barras apiladas en un gráfico circular usando coord_polar().</p>
<p><span style="color:blue">- ¿Qué hace labs()? Lee la documentación.</p>
<p><span style="color:blue">- ¿Cuál es la diferencia entre coord_quickmap() y coord_map()?</p>
<p><span style="color:blue">- ¿Qué te dice la gráfica siguiente sobre la relación entre ciudad y autopista? ¿Por qué es coord_fixed() importante? ¿Qué hace geom_abline()?</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="programando-con-r.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ciudad, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb270-2"><a href="programando-con-r.html#cb270-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb270-3"><a href="programando-con-r.html#cb270-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>() <span class="sc">+</span></span>
<span id="cb270-4"><a href="programando-con-r.html#cb270-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-133-1.png" width="672" /></p>
</div>
<div id="la-gramática-de-gráficos-en-capas" class="section level3" number="3.8.10">
<h3><span class="header-section-number">3.8.10</span> La gramática de gráficos en capas</h3>
<p>En las secciones anteriores aprendiste mucho más que solo hacer diagramas de dispersión, gráficos de barras y diagramas de caja. Aprendiste una base que se puede usar para hacer cualquier tipo de gráfico con ggplot2. Para ver esto, agreguemos ajustes de posición, transformaciones estadísticas, sistemas de coordenadas y facetas a nuestra plantilla de código:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="programando-con-r.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="sc">&lt;</span>DATOS<span class="sc">&gt;</span>) <span class="sc">+</span></span>
<span id="cb271-2"><a href="programando-con-r.html#cb271-2" aria-hidden="true" tabindex="-1"></a> <span class="er">&lt;</span>GEOM_FUNCIÓN<span class="sc">&gt;</span>(</span>
<span id="cb271-3"><a href="programando-con-r.html#cb271-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="sc">&lt;</span>MAPEOS<span class="sc">&gt;</span>),</span>
<span id="cb271-4"><a href="programando-con-r.html#cb271-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">stat =</span> <span class="sc">&lt;</span>ESTADÍSTICAS<span class="sc">&gt;</span>,</span>
<span id="cb271-5"><a href="programando-con-r.html#cb271-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">position =</span> <span class="sc">&lt;</span>POSICIÓN<span class="sc">&gt;</span></span>
<span id="cb271-6"><a href="programando-con-r.html#cb271-6" aria-hidden="true" tabindex="-1"></a> ) <span class="sc">+</span></span>
<span id="cb271-7"><a href="programando-con-r.html#cb271-7" aria-hidden="true" tabindex="-1"></a> <span class="er">&lt;</span>FUNCIÓN_COORDENADAS<span class="sc">&gt;</span> <span class="sc">+</span></span>
<span id="cb271-8"><a href="programando-con-r.html#cb271-8" aria-hidden="true" tabindex="-1"></a> <span class="er">&lt;</span>FUNCIÓN_FACETAS<span class="sc">&gt;</span></span></code></pre></div>
<p>Nuestra nueva plantilla tiene siete parámetros que se corresponden con las palabras entre corchetes que aparecen en la plantilla. En la práctica, rara vez necesitas proporcionar los siete parámetros para hacer un gráfico porque ggplot2 proporcionará valores predeterminados útiles para todos, excepto para los datos, el mapeo y la función geom.</p>
<p>Los siete parámetros en la plantilla componen la gramática de los gráficos, un sistema formal de construcción de gráficos. La gramática de los gráficos se basa en la idea de que puedes describir de manera única cualquier gráfico como una combinación de un conjunto de datos, un geom, un conjunto de mapeos, una estadística, un ajuste de posición, un sistema de coordenadas y un esquema de facetado.</p>
<p>Para ver cómo funciona esto, considera cómo podrías construir un gráfico básico desde cero: podrías comenzar con un conjunto de datos y luego transformarlo en la información que deseas mostrar (con un stat).</p>
<p align="center">
<img width="900" src="https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/visualization-grammar-1.svg">
</p>
<p>A continuación, podrías elegir un objeto geométrico para representar cada observación en los datos transformados. Luego, podrías usar las propiedades estéticas de los geoms para representar variables de los datos. Asignarías los valores de cada variable a los niveles de una estética.</p>
<p align="center">
<img width="900" src="https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/visualization-grammar-2.svg">
</p>
<p>Posteriormente, podrías seleccionar un sistema de coordenadas para colocar los geoms. Podrías utilizar la ubicación de los objetos (que es en sí misma una propiedad estética) para mostrar los valores de las variables x e y. Ya en este punto podrías tener un gráfico completo, pero también podrías ajustar aún más las posiciones de los geoms dentro del sistema de coordenadas (un ajuste de posición) o dividir el gráfico en facetas. También podrías extender el gráfico agregando una o más capas adicionales, donde cada capa adicional usaría un conjunto de datos, un geom, un conjunto de mapeos, una estadística y un ajuste de posición.</p>
<p align="center">
<img width="900" src="https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/visualization-grammar-3.svg">
</p>
<p>Puedes usar este método para construir cualquier gráfico que imagines. En otras palabras, puedes usar la plantilla de código que aprendiste en este capítulo para construir cientos de miles de gráficos únicos.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introducción-a-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rmarkdown.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdownproj.pdf", "bookdownproj.epub", "bookdownproj.mobi"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

</body>

</html>
